<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interface to fastai  • fastai</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/readable/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><!-- docsearch --><script src="docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Interface to fastai ">
<meta property="og:description" content="The fastai &lt;https://docs.fast.ai/index.html&gt; library 
             simplifies training fast and accurate neural networks 
             using modern best practices. It is based on research 
             in to deep learning best practices undertaken 
             at fast.ai, including out of the box support
             for vision, text, tabular, audio, time series, and 
             collaborative filtering models. ">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">fastai</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/Basic_Tabular.html">Basic Tabular</a>
    </li>
    <li>
      <a href="articles/basic_img_class.html">Basic Image classification</a>
    </li>
    <li>
      <a href="articles/head_pose.html">Head pose</a>
    </li>
    <li>
      <a href="articles/super_res_gan.html">Super-Resolution GAN</a>
    </li>
    <li>
      <a href="articles/medical_dcm.html">Medical image classification</a>
    </li>
    <li>
      <a href="articles/data_aug.html">Data augmentation</a>
    </li>
    <li>
      <a href="articles/obj_detect.html">Object detection</a>
    </li>
    <li>
      <a href="articles/audio.html">Audio classification</a>
    </li>
    <li>
      <a href="articles/time_series.html">Time series</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Migrate
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/migrating_pytorch.html">Plain Pytorch</a>
    </li>
    <li>
      <a href="articles/migrating_ignite.html">Ignite</a>
    </li>
    <li>
      <a href="articles/lightning.html">Lightning</a>
    </li>
    <li>
      <a href="articles/catalyst.html">Catalyst</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Learn
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/custom_img.html">Image Classification</a>
    </li>
    <li>
      <a href="articles/audio2tf.html">Speech Recognition</a>
    </li>
    <li>
      <a href="articles/gpt.html">GPT2</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Training
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/optimizer.html">Optimizers</a>
    </li>
    <li>
      <a href="articles/callbacks.html">Callbacks</a>
    </li>
    <li>
      <a href="articles/low.html">Low-level API</a>
    </li>
    <li>
      <a href="articles/bayes_opt.html">Bayesian Optimization</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    NLP
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/textclassification.html">RoBERTa binary classification</a>
    </li>
    <li>
      <a href="articles/multilabel.html">Multilabel classification</a>
    </li>
    <li>
      <a href="articles/question_answering.html">Question-answering</a>
    </li>
    <li>
      <a href="articles/textsummarize.html">Text-summarization</a>
    </li>
  </ul>
</li>
<li>
  <a href="reference/index.html">Refer</a>
</li>
<li>
  <a href="news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/EagerAI/fastai/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<div class="section level2">
<h2 id="r-interface-to-fastai">R interface to fastai<a class="anchor" aria-label="anchor" href="#r-interface-to-fastai"></a>
</h2>
<p>The fastai package provides R wrappers to <a href="https://github.com/fastai/fastai" class="external-link">fastai</a>.</p>
<p>The fastai library simplifies training fast and accurate neural nets using modern best practices. See the <a href="https://eagerai.github.io/fastai/" class="external-link">fastai website</a> to get started. The library is based on research into deep learning best practices undertaken at <code>fast.ai</code>, and includes “out of the box” support for <code>vision</code>, <code>text</code>, <code>tabular</code>, and <code>collab</code> (collaborative filtering) models.</p>
<p><img src="files/fastai.png" width="200" align="right" style="margin-left: 15px;" alt="fastai"></p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html" class="external-link"><img src="https://img.shields.io/badge/lifecycle-stable-brightgreen.svg" alt="Lifecycle: stable"></a> <a href="https://CRAN.R-project.org/package=fastai" class="external-link"><img src="https://www.r-pkg.org/badges/version/fastai" alt="CRAN status"></a> <a href="https://cran.r-project.org/package=fastai" class="external-link"><img src="http://cranlogs.r-pkg.org/badges/last-month/fastai?color=green" alt="Last month downloads"></a></p>
</div>
<div class="section level2">
<h2 id="continuous-build-status">Continuous Build Status<a class="anchor" aria-label="anchor" href="#continuous-build-status"></a>
</h2>
<table class="table">
<colgroup>
<col width="17%">
<col width="82%">
</colgroup>
<thead><tr class="header">
<th>Build</th>
<th>Status</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Bionic</strong></td>
<td><img src="https://github.com/EagerAI/fastai/workflows/ubuntu_18/badge.svg" alt="ubuntu_18"></td>
</tr>
<tr class="even">
<td><strong>Focal</strong></td>
<td><img src="https://github.com/EagerAI/fastai/workflows/ubuntu_20/badge.svg" alt="ubuntu_20"></td>
</tr>
<tr class="odd">
<td><strong>Mac OS</strong></td>
<td><img src="https://github.com/EagerAI/fastai/workflows/mac_os/badge.svg" alt="mac_os"></td>
</tr>
<tr class="even">
<td><strong>Windows</strong></td>
<td><img src="https://github.com/EagerAI/fastai/workflows/windows/badge.svg" alt="windows"></td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p><strong>1. Install miniconda and activate environment:</strong></p>
<pre><code><span><span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/install_miniconda.html" class="external-link">install_miniconda</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/conda-tools.html" class="external-link">conda_create</a></span><span class="op">(</span><span class="st">'r-reticulate'</span><span class="op">)</span></span></code></pre>
<p><strong>2. The dev version:</strong></p>
<pre><code><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">'eagerai/fastai'</span><span class="op">)</span></span></code></pre>
<p><strong>3. Later, you need to install the python module <code>fastai</code>:</strong></p>
<pre><code><span><span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/use_python.html" class="external-link">use_condaenv</a></span><span class="op">(</span><span class="st">'r-reticulate'</span>,required <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu">fastai</span><span class="fu">::</span><span class="fu"><a href="reference/install_fastai.html">install_fastai</a></span><span class="op">(</span>gpu <span class="op">=</span> <span class="cn">FALSE</span>, cuda_version <span class="op">=</span> <span class="st">'10'</span>, overwrite <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre>
<p><strong>4. Restart RStudio!</strong></p>
</div>
<div class="section level2">
<h2 id="fastai-extensions">fast.ai extensions:<a class="anchor" aria-label="anchor" href="#fastai-extensions"></a>
</h2>
<ol style="list-style-type: decimal">
<li><a href="https://github.com/ohmeow/blurr" class="external-link">NLP, Transformers</a></li>
<li><a href="https://github.com/airctic/icevision" class="external-link">Object Detection</a></li>
<li><a href="https://github.com/tcapelle/timeseries_fastai" class="external-link">Time-series</a></li>
<li><a href="https://github.com/tmabraham/UPIT" class="external-link">CycleGAN</a></li>
<li><a href="https://github.com/fastaudio/fastaudio" class="external-link">Audio</a></li>
</ol>
</div>
<div class="section level2">
<h2 id="kaggle">Kaggle<a class="anchor" aria-label="anchor" href="#kaggle"></a>
</h2>
<p>We currently prepare the examples of usage of the fastai from R in Kaggle competitions:</p>
<ul>
<li><a href="https://www.kaggle.com/henry090/r-interface-to-fastai" class="external-link">Introduction</a></li>
<li><a href="https://www.kaggle.com/henry090/r-and-fastai" class="external-link">MNIST with Pytorch and fastai</a></li>
<li><a href="https://www.kaggle.com/henry090/r-fastai-and-transformers" class="external-link">NLP Binary Classification</a></li>
<li><a href="https://www.kaggle.com/henry090/fast-ai-from-r" class="external-link">Audio classification</a></li>
<li><a href="https://www.kaggle.com/henry090/r-fast-ai-and-cyclegan" class="external-link">CycleGAN</a></li>
<li><a href="https://colab.research.google.com/drive/1PiBECDM552No-5apVIB8LqUSdSqqJSi-?usp=sharing" class="external-link">Fastai on Colab TPUs</a></li>
</ul>
<blockquote>
<p>Contributions are very welcome!</p>
</blockquote>
</div>
<div class="section level2">
<h2 id="tabular-data">Tabular data<a class="anchor" aria-label="anchor" href="#tabular-data"></a>
</h2>
<pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/EagerAI/fastai" class="external-link">fastai</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># download</span></span>
<span><span class="fu"><a href="reference/URLs_ADULT_SAMPLE.html">URLs_ADULT_SAMPLE</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># read data</span></span>
<span><span class="va">df</span> <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="st">'adult_sample/adult.csv'</span><span class="op">)</span></span></code></pre>
<p>Variables:</p>
<pre><code><span><span class="va">dep_var</span> <span class="op">=</span> <span class="st">'salary'</span></span>
<span><span class="va">cat_names</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'workclass'</span>, <span class="st">'education'</span>, <span class="st">'marital-status'</span>, <span class="st">'occupation'</span>, <span class="st">'relationship'</span>, <span class="st">'race'</span><span class="op">)</span></span>
<span><span class="va">cont_names</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'age'</span>, <span class="st">'fnlwgt'</span>, <span class="st">'education-num'</span><span class="op">)</span></span></code></pre>
<p>Preprocess strategy:</p>
<pre><code><span><span class="va">procs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="reference/FillMissing.html">FillMissing</a></span><span class="op">(</span><span class="op">)</span>,<span class="fu"><a href="reference/Categorify.html">Categorify</a></span><span class="op">(</span><span class="op">)</span>,<span class="fu"><a href="reference/Normalize.html">Normalize</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre>
<p>Prepare:</p>
<pre><code><span><span class="va">dls</span> <span class="op">=</span> <span class="fu"><a href="reference/TabularDataTable.html">TabularDataTable</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">procs</span>, <span class="va">cat_names</span>, <span class="va">cont_names</span>,</span>
<span>      y_names <span class="op">=</span> <span class="va">dep_var</span>, splits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">32000</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">32001</span><span class="op">:</span><span class="fl">32561</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="reference/dataloaders.html">dataloaders</a></span><span class="op">(</span>bs <span class="op">=</span> <span class="fl">64</span><span class="op">)</span></span></code></pre>
<p>Summary:</p>
<pre><code><span><span class="va">model</span> <span class="op">=</span> <span class="va">dls</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/tabular_learner.html">tabular_learner</a></span><span class="op">(</span>layers<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>,<span class="fl">100</span><span class="op">)</span>, metrics<span class="op">=</span><span class="va">accuracy</span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span></code></pre>
<pre><code>TabularModel (Input shape: ['64 x 7', '64 x 3'])
================================================================
Layer (type)         Output Shape         Param #    Trainable
================================================================
Embedding            64 x 6               60         True
________________________________________________________________
Embedding            64 x 8               136        True
________________________________________________________________
Embedding            64 x 5               40         True
________________________________________________________________
Embedding            64 x 8               136        True
________________________________________________________________
Embedding            64 x 5               35         True
________________________________________________________________
Embedding            64 x 4               24         True
________________________________________________________________
Embedding            64 x 3               9          True
________________________________________________________________
Dropout              64 x 39              0          False
________________________________________________________________
BatchNorm1d          64 x 3               6          True
________________________________________________________________
BatchNorm1d          64 x 42              84         True
________________________________________________________________
Linear               64 x 200             8,400      True
________________________________________________________________
ReLU                 64 x 200             0          False
________________________________________________________________
BatchNorm1d          64 x 200             400        True
________________________________________________________________
Linear               64 x 100             20,000     True
________________________________________________________________
ReLU                 64 x 100             0          False
________________________________________________________________
Linear               64 x 2               202        True
________________________________________________________________

Total params: 29,532
Total trainable params: 29,532
Total non-trainable params: 0

Optimizer used: &lt;function Adam at 0x7fa246283598&gt;
Loss function: FlattenedLoss of CrossEntropyLoss()

Callbacks:
  - TrainEvalCallback
  - Recorder
  - ProgressCallback</code></pre>
<p>Before fitting try to find optimal learning rate:</p>
<pre><code><span><span class="va">model</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/lr_find.html">lr_find</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/plot_lr_find.html">plot_lr_find</a></span><span class="op">(</span>dpi <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span></code></pre>
<p><img src="files/plot_lr.png" height="500" align="center" alt="lr"></p>
<p>Run:</p>
<pre><code><span><span class="va">model</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="fl">5</span>, lr <span class="op">=</span> <span class="fl">10</span><span class="op">^</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span></code></pre>
<pre><code>epoch     train_loss  valid_loss  accuracy  time
0         0.360149    0.329587    0.846702  00:04
1         0.352106    0.345761    0.828877  00:04
2         0.368743    0.340913    0.844920  00:05
3         0.347277    0.333084    0.852050  00:04
4         0.348969    0.350707    0.830660  00:04</code></pre>
<p>Plot loss history:</p>
<pre><code><span><span class="va">model</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/plot_loss.html">plot_loss</a></span><span class="op">(</span>dpi <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span></code></pre>
<p><img src="files/plot_loss.png" height="500" align="center" alt="lr"></p>
<p>See training process:</p>
<p align="center">
<img src="files/fastai.gif" height="350" align="center" alt="train"></p>
<p>Get confusion matrix:</p>
<pre><code><span><span class="va">model</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/get_confusion_matrix.html">get_confusion_matrix</a></span><span class="op">(</span><span class="op">)</span></span></code></pre>
<pre><code>       &lt;50k  &gt;=50k
&lt;50k   407    22
&gt;=50k   68    64</code></pre>
<p>Plot it:</p>
<pre><code><span><span class="va">interp</span> <span class="op">=</span> <span class="fu"><a href="reference/ClassificationInterpretation_from_learner.html">ClassificationInterpretation_from_learner</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span></span>
<span><span class="va">interp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/plot_confusion_matrix.html">plot_confusion_matrix</a></span><span class="op">(</span>dpi <span class="op">=</span> <span class="fl">90</span>,figsize <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">6</span><span class="op">)</span><span class="op">)</span></span></code></pre>
<p><img src="files/conf_.png" height="500" align="center" alt="Pets"></p>
<p>Get predictions on new data:</p>
<pre><code>&gt; model %&gt;% predict(df[10:15,])

       &lt;50k     &gt;=50k classes
1 0.5108562 0.4891439       0
2 0.4827824 0.5172176       1
3 0.4873166 0.5126833       1
4 0.5013804 0.4986197       0
5 0.4964157 0.5035844       1
6 0.5111378 0.4888622       0</code></pre>
</div>
<div class="section level2">
<h2 id="image-data">Image data<a class="anchor" aria-label="anchor" href="#image-data"></a>
</h2>
<p>Get Pets dataset:</p>
<pre><code><span><span class="fu"><a href="reference/URLs_PETS.html">URLs_PETS</a></span><span class="op">(</span><span class="op">)</span></span></code></pre>
<p>Define path to folders:</p>
<pre><code><span><span class="va">path</span> <span class="op">=</span> <span class="st">'oxford-iiit-pet'</span></span>
<span><span class="va">path_anno</span> <span class="op">=</span> <span class="st">'oxford-iiit-pet/annotations'</span></span>
<span><span class="va">path_img</span> <span class="op">=</span> <span class="st">'oxford-iiit-pet/images'</span></span>
<span><span class="va">fnames</span> <span class="op">=</span> <span class="fu"><a href="reference/get_image_files.html">get_image_files</a></span><span class="op">(</span><span class="va">path_img</span><span class="op">)</span></span></code></pre>
<p>See one of examples:</p>
<pre><code><span><span class="va">fnames</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="va">oxford</span><span class="op">-</span><span class="va">iiit</span><span class="op">-</span><span class="va">pet</span><span class="op">/</span><span class="va">images</span><span class="op">/</span><span class="va">american_pit_bull_terrier_129.jpg</span></span></code></pre>
<p>Dataloader:</p>
<pre><code><span><span class="va">dls</span> <span class="op">=</span> <span class="fu"><a href="reference/ImageDataLoaders_from_name_re.html">ImageDataLoaders_from_name_re</a></span><span class="op">(</span></span>
<span>  <span class="va">path</span>, <span class="va">fnames</span>, pat<span class="op">=</span><span class="st">'(.+)_\\d+.jpg$'</span>,</span>
<span>  item_tfms<span class="op">=</span><span class="fu"><a href="reference/Resize.html">Resize</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">460</span><span class="op">)</span>, bs <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  batch_tfms<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="reference/Normalize_from_stats.html">Normalize_from_stats</a></span><span class="op">(</span> <span class="fu"><a href="reference/imagenet_stats.html">imagenet_stats</a></span><span class="op">(</span><span class="op">)</span> <span class="op">)</span></span>
<span>                  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
<p>Show batch for visualization:</p>
<pre><code><span><span class="va">dls</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/show_batch.html">show_batch</a></span><span class="op">(</span><span class="op">)</span></span></code></pre>
<p><img src="files/pets.png" height="500" align="center" alt="Pets"></p>
<p>Model architecture:</p>
<pre><code><span><span class="va">learn</span> <span class="op">=</span> <span class="fu"><a href="reference/cnn_learner.html">cnn_learner</a></span><span class="op">(</span><span class="va">dls</span>, <span class="fu"><a href="reference/resnet34.html">resnet34</a></span><span class="op">(</span><span class="op">)</span>, metrics <span class="op">=</span> <span class="va">error_rate</span><span class="op">)</span></span></code></pre>
<p>And fit:</p>
<pre><code>learn %&gt;% fit_one_cycle(n_epoch = 2)

epoch     train_loss  valid_loss  error_rate  time
0         0.904872    0.317927    0.105548    00:35
1         0.694395    0.239520    0.083897    00:36</code></pre>
<p>Get confusion matrix and plot:</p>
<pre><code><span><span class="va">conf</span> <span class="op">=</span> <span class="va">learn</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/get_confusion_matrix.html">get_confusion_matrix</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jkunst.com/highcharter/" class="external-link">highcharter</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://jkunst.com/highcharter/reference/hchart.html" class="external-link">hchart</a></span><span class="op">(</span><span class="va">conf</span>, label <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://jkunst.com/highcharter/reference/hc_yAxis.html" class="external-link">hc_yAxis</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>text <span class="op">=</span> <span class="st">'Actual'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://jkunst.com/highcharter/reference/hc_xAxis.html" class="external-link">hc_xAxis</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>text <span class="op">=</span> <span class="st">'Predicted'</span><span class="op">)</span>,</span>
<span>             labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>rotation <span class="op">=</span> <span class="op">-</span><span class="fl">90</span><span class="op">)</span><span class="op">)</span></span></code></pre>
<p><img src="files/conf.png" height="500" align="center" alt="Pets"></p>
<blockquote>
<p>Note that the plot is built with highcharter.</p>
</blockquote>
<p>Plot top losses:</p>
<pre><code><span><span class="va">interp</span> <span class="op">=</span> <span class="fu"><a href="reference/ClassificationInterpretation_from_learner.html">ClassificationInterpretation_from_learner</a></span><span class="op">(</span><span class="va">learn</span><span class="op">)</span></span>
<span></span>
<span><span class="va">interp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/plot_top_losses.html">plot_top_losses</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fl">9</span>, figsize <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>,<span class="fl">11</span><span class="op">)</span><span class="op">)</span></span></code></pre>
<p><img src="files/top_loss.png" height="500" align="center" alt="Pets"></p>
<p>Alternatively, load images from folders:</p>
<pre><code><span><span class="co"># get sample data</span></span>
<span><span class="fu"><a href="reference/URLs_MNIST_SAMPLE.html">URLs_MNIST_SAMPLE</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># transformations</span></span>
<span><span class="va">path</span> <span class="op">=</span> <span class="st">'mnist_sample'</span></span>
<span><span class="va">bs</span> <span class="op">=</span> <span class="fl">20</span></span>
<span></span>
<span><span class="co">#load into memory</span></span>
<span><span class="va">data</span> <span class="op">=</span> <span class="fu"><a href="reference/ImageDataLoaders_from_folder.html">ImageDataLoaders_from_folder</a></span><span class="op">(</span><span class="va">path</span>, size <span class="op">=</span> <span class="fl">26</span>, bs <span class="op">=</span> <span class="va">bs</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize and train</span></span>
<span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/show_batch.html">show_batch</a></span><span class="op">(</span>dpi <span class="op">=</span> <span class="fl">150</span><span class="op">)</span></span>
<span></span>
<span><span class="va">learn</span> <span class="op">=</span> <span class="fu"><a href="reference/cnn_learner.html">cnn_learner</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="reference/resnet18.html">resnet18</a></span><span class="op">(</span><span class="op">)</span>, metrics <span class="op">=</span> <span class="va">accuracy</span><span class="op">)</span></span>
<span><span class="va">learn</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span></code></pre>
<p><img src="files/mnist.png" height="500" align="center" alt="Mnist"></p>
<p><strong>What about the implementation of the latest <a href="https://github.com/rwightman/pytorch-image-models" class="external-link">Computer Vision models</a>?</strong></p>
<p>There is a function in fastai <code>timm_learner</code> which originally written by <a href="https://github.com/walkwithfastai/walkwithfastai.github.io/" class="external-link">Zachary Mueller</a>. It helps to quickly load the pretrained models from <a href="https://github.com/rwightman/pytorch-image-models" class="external-link">timm library</a>.</p>
<p>First, lets’s see the list of available models (TOP 10):</p>
<pre><code>&gt; str(as.list(timm_list_models()[1:10]))
List of 10
 $ : chr "adv_inception_v3"
 $ : chr "cspdarknet53"
 $ : chr "cspdarknet53_iabn"
 $ : chr "cspresnet50"
 $ : chr "cspresnet50d"
 $ : chr "cspresnet50w"
 $ : chr "cspresnext50"
 $ : chr "cspresnext50_iabn"
 $ : chr "darknet53"
 $ : chr "densenet121"</code></pre>
<p>Exciting!</p>
<p>Now, load and train pets dataset:</p>
<pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/EagerAI/fastai" class="external-link">fastai</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">path</span> <span class="op">=</span> <span class="st">'oxford-iiit-pet'</span></span>
<span></span>
<span><span class="va">path_img</span> <span class="op">=</span> <span class="st">'oxford-iiit-pet/images'</span></span>
<span></span>
<span><span class="va">fnames</span> <span class="op">=</span> <span class="fu"><a href="reference/get_image_files.html">get_image_files</a></span><span class="op">(</span><span class="va">path_img</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dls</span> <span class="op">=</span> <span class="fu"><a href="reference/ImageDataLoaders_from_name_re.html">ImageDataLoaders_from_name_re</a></span><span class="op">(</span></span>
<span>  <span class="va">path</span>, <span class="va">fnames</span>, pat<span class="op">=</span><span class="st">'(.+)_\\d+.jpg$'</span>,</span>
<span>  item_tfms<span class="op">=</span><span class="fu"><a href="reference/Resize.html">Resize</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">460</span><span class="op">)</span>, bs <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  batch_tfms<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="reference/Normalize_from_stats.html">Normalize_from_stats</a></span><span class="op">(</span> <span class="fu"><a href="reference/imagenet_stats.html">imagenet_stats</a></span><span class="op">(</span><span class="op">)</span> <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">learn</span> <span class="op">=</span> <span class="fu"><a href="reference/timm_learner.html">timm_learner</a></span><span class="op">(</span><span class="va">dls</span>, <span class="st">'cspdarknet53'</span>, metrics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">accuracy</span>, <span class="va">error_rate</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">learn</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span></code></pre>
<details><summary>
Model summary
</summary><p>
</p>
<pre><code>Sequential (Input shape: ['10 x 3 x 224 x 224'])
================================================================
Layer (type)         Output Shape         Param #    Trainable
================================================================
Conv2d               10 x 32 x 224 x 224  864        False
________________________________________________________________
LeakyReLU            10 x 32 x 224 x 224  0          False
________________________________________________________________
Conv2d               10 x 64 x 112 x 112  18,432     False
________________________________________________________________
LeakyReLU            10 x 64 x 112 x 112  0          False
________________________________________________________________
Conv2d               10 x 128 x 112 x 11  8,192      False
________________________________________________________________
LeakyReLU            10 x 128 x 112 x 11  0          False
________________________________________________________________
Conv2d               10 x 32 x 112 x 112  2,048      False
________________________________________________________________
LeakyReLU            10 x 32 x 112 x 112  0          False
________________________________________________________________
Conv2d               10 x 64 x 112 x 112  18,432     False
________________________________________________________________
LeakyReLU            10 x 64 x 112 x 112  0          False
________________________________________________________________
Conv2d               10 x 64 x 112 x 112  4,096      False
________________________________________________________________
LeakyReLU            10 x 64 x 112 x 112  0          False
________________________________________________________________
Conv2d               10 x 64 x 112 x 112  8,192      False
________________________________________________________________
LeakyReLU            10 x 64 x 112 x 112  0          False
________________________________________________________________
Conv2d               10 x 128 x 56 x 56   73,728     False
________________________________________________________________
LeakyReLU            10 x 128 x 56 x 56   0          False
________________________________________________________________
Conv2d               10 x 128 x 56 x 56   16,384     False
________________________________________________________________
LeakyReLU            10 x 128 x 56 x 56   0          False
________________________________________________________________
Conv2d               10 x 64 x 56 x 56    4,096      False
________________________________________________________________
LeakyReLU            10 x 64 x 56 x 56    0          False
________________________________________________________________
Conv2d               10 x 64 x 56 x 56    36,864     False
________________________________________________________________
LeakyReLU            10 x 64 x 56 x 56    0          False
________________________________________________________________
Conv2d               10 x 64 x 56 x 56    4,096      False
________________________________________________________________
LeakyReLU            10 x 64 x 56 x 56    0          False
________________________________________________________________
Conv2d               10 x 64 x 56 x 56    36,864     False
________________________________________________________________
LeakyReLU            10 x 64 x 56 x 56    0          False
________________________________________________________________
Conv2d               10 x 64 x 56 x 56    4,096      False
________________________________________________________________
LeakyReLU            10 x 64 x 56 x 56    0          False
________________________________________________________________
Conv2d               10 x 128 x 56 x 56   16,384     False
________________________________________________________________
LeakyReLU            10 x 128 x 56 x 56   0          False
________________________________________________________________
Conv2d               10 x 256 x 28 x 28   294,912    False
________________________________________________________________
LeakyReLU            10 x 256 x 28 x 28   0          False
________________________________________________________________
Conv2d               10 x 256 x 28 x 28   65,536     False
________________________________________________________________
LeakyReLU            10 x 256 x 28 x 28   0          False
________________________________________________________________
Conv2d               10 x 128 x 28 x 28   16,384     False
________________________________________________________________
LeakyReLU            10 x 128 x 28 x 28   0          False
________________________________________________________________
Conv2d               10 x 128 x 28 x 28   147,456    False
________________________________________________________________
LeakyReLU            10 x 128 x 28 x 28   0          False
________________________________________________________________
Conv2d               10 x 128 x 28 x 28   16,384     False
________________________________________________________________
LeakyReLU            10 x 128 x 28 x 28   0          False
________________________________________________________________
Conv2d               10 x 128 x 28 x 28   147,456    False
________________________________________________________________
LeakyReLU            10 x 128 x 28 x 28   0          False
________________________________________________________________
Conv2d               10 x 128 x 28 x 28   16,384     False
________________________________________________________________
LeakyReLU            10 x 128 x 28 x 28   0          False
________________________________________________________________
Conv2d               10 x 128 x 28 x 28   147,456    False
________________________________________________________________
LeakyReLU            10 x 128 x 28 x 28   0          False
________________________________________________________________
Conv2d               10 x 128 x 28 x 28   16,384     False
________________________________________________________________
LeakyReLU            10 x 128 x 28 x 28   0          False
________________________________________________________________
Conv2d               10 x 128 x 28 x 28   147,456    False
________________________________________________________________
LeakyReLU            10 x 128 x 28 x 28   0          False
________________________________________________________________
Conv2d               10 x 128 x 28 x 28   16,384     False
________________________________________________________________
LeakyReLU            10 x 128 x 28 x 28   0          False
________________________________________________________________
Conv2d               10 x 128 x 28 x 28   147,456    False
________________________________________________________________
LeakyReLU            10 x 128 x 28 x 28   0          False
________________________________________________________________
Conv2d               10 x 128 x 28 x 28   16,384     False
________________________________________________________________
LeakyReLU            10 x 128 x 28 x 28   0          False
________________________________________________________________
Conv2d               10 x 128 x 28 x 28   147,456    False
________________________________________________________________
LeakyReLU            10 x 128 x 28 x 28   0          False
________________________________________________________________
Conv2d               10 x 128 x 28 x 28   16,384     False
________________________________________________________________
LeakyReLU            10 x 128 x 28 x 28   0          False
________________________________________________________________
Conv2d               10 x 128 x 28 x 28   147,456    False
________________________________________________________________
LeakyReLU            10 x 128 x 28 x 28   0          False
________________________________________________________________
Conv2d               10 x 128 x 28 x 28   16,384     False
________________________________________________________________
LeakyReLU            10 x 128 x 28 x 28   0          False
________________________________________________________________
Conv2d               10 x 128 x 28 x 28   147,456    False
________________________________________________________________
LeakyReLU            10 x 128 x 28 x 28   0          False
________________________________________________________________
Conv2d               10 x 128 x 28 x 28   16,384     False
________________________________________________________________
LeakyReLU            10 x 128 x 28 x 28   0          False
________________________________________________________________
Conv2d               10 x 256 x 28 x 28   65,536     False
________________________________________________________________
LeakyReLU            10 x 256 x 28 x 28   0          False
________________________________________________________________
Conv2d               10 x 512 x 14 x 14   1,179,648  False
________________________________________________________________
LeakyReLU            10 x 512 x 14 x 14   0          False
________________________________________________________________
Conv2d               10 x 512 x 14 x 14   262,144    False
________________________________________________________________
LeakyReLU            10 x 512 x 14 x 14   0          False
________________________________________________________________
Conv2d               10 x 256 x 14 x 14   65,536     False
________________________________________________________________
LeakyReLU            10 x 256 x 14 x 14   0          False
________________________________________________________________
Conv2d               10 x 256 x 14 x 14   589,824    False
________________________________________________________________
LeakyReLU            10 x 256 x 14 x 14   0          False
________________________________________________________________
Conv2d               10 x 256 x 14 x 14   65,536     False
________________________________________________________________
LeakyReLU            10 x 256 x 14 x 14   0          False
________________________________________________________________
Conv2d               10 x 256 x 14 x 14   589,824    False
________________________________________________________________
LeakyReLU            10 x 256 x 14 x 14   0          False
________________________________________________________________
Conv2d               10 x 256 x 14 x 14   65,536     False
________________________________________________________________
LeakyReLU            10 x 256 x 14 x 14   0          False
________________________________________________________________
Conv2d               10 x 256 x 14 x 14   589,824    False
________________________________________________________________
LeakyReLU            10 x 256 x 14 x 14   0          False
________________________________________________________________
Conv2d               10 x 256 x 14 x 14   65,536     False
________________________________________________________________
LeakyReLU            10 x 256 x 14 x 14   0          False
________________________________________________________________
Conv2d               10 x 256 x 14 x 14   589,824    False
________________________________________________________________
LeakyReLU            10 x 256 x 14 x 14   0          False
________________________________________________________________
Conv2d               10 x 256 x 14 x 14   65,536     False
________________________________________________________________
LeakyReLU            10 x 256 x 14 x 14   0          False
________________________________________________________________
Conv2d               10 x 256 x 14 x 14   589,824    False
________________________________________________________________
LeakyReLU            10 x 256 x 14 x 14   0          False
________________________________________________________________
Conv2d               10 x 256 x 14 x 14   65,536     False
________________________________________________________________
LeakyReLU            10 x 256 x 14 x 14   0          False
________________________________________________________________
Conv2d               10 x 256 x 14 x 14   589,824    False
________________________________________________________________
LeakyReLU            10 x 256 x 14 x 14   0          False
________________________________________________________________
Conv2d               10 x 256 x 14 x 14   65,536     False
________________________________________________________________
LeakyReLU            10 x 256 x 14 x 14   0          False
________________________________________________________________
Conv2d               10 x 256 x 14 x 14   589,824    False
________________________________________________________________
LeakyReLU            10 x 256 x 14 x 14   0          False
________________________________________________________________
Conv2d               10 x 256 x 14 x 14   65,536     False
________________________________________________________________
LeakyReLU            10 x 256 x 14 x 14   0          False
________________________________________________________________
Conv2d               10 x 256 x 14 x 14   589,824    False
________________________________________________________________
LeakyReLU            10 x 256 x 14 x 14   0          False
________________________________________________________________
Conv2d               10 x 256 x 14 x 14   65,536     False
________________________________________________________________
LeakyReLU            10 x 256 x 14 x 14   0          False
________________________________________________________________
Conv2d               10 x 512 x 14 x 14   262,144    False
________________________________________________________________
LeakyReLU            10 x 512 x 14 x 14   0          False
________________________________________________________________
Conv2d               10 x 1024 x 7 x 7    4,718,592  False
________________________________________________________________
LeakyReLU            10 x 1024 x 7 x 7    0          False
________________________________________________________________
Conv2d               10 x 1024 x 7 x 7    1,048,576  False
________________________________________________________________
LeakyReLU            10 x 1024 x 7 x 7    0          False
________________________________________________________________
Conv2d               10 x 512 x 7 x 7     262,144    False
________________________________________________________________
LeakyReLU            10 x 512 x 7 x 7     0          False
________________________________________________________________
Conv2d               10 x 512 x 7 x 7     2,359,296  False
________________________________________________________________
LeakyReLU            10 x 512 x 7 x 7     0          False
________________________________________________________________
Conv2d               10 x 512 x 7 x 7     262,144    False
________________________________________________________________
LeakyReLU            10 x 512 x 7 x 7     0          False
________________________________________________________________
Conv2d               10 x 512 x 7 x 7     2,359,296  False
________________________________________________________________
LeakyReLU            10 x 512 x 7 x 7     0          False
________________________________________________________________
Conv2d               10 x 512 x 7 x 7     262,144    False
________________________________________________________________
LeakyReLU            10 x 512 x 7 x 7     0          False
________________________________________________________________
Conv2d               10 x 512 x 7 x 7     2,359,296  False
________________________________________________________________
LeakyReLU            10 x 512 x 7 x 7     0          False
________________________________________________________________
Conv2d               10 x 512 x 7 x 7     262,144    False
________________________________________________________________
LeakyReLU            10 x 512 x 7 x 7     0          False
________________________________________________________________
Conv2d               10 x 512 x 7 x 7     2,359,296  False
________________________________________________________________
LeakyReLU            10 x 512 x 7 x 7     0          False
________________________________________________________________
Conv2d               10 x 512 x 7 x 7     262,144    False
________________________________________________________________
LeakyReLU            10 x 512 x 7 x 7     0          False
________________________________________________________________
Conv2d               10 x 1024 x 7 x 7    1,048,576  False
________________________________________________________________
LeakyReLU            10 x 1024 x 7 x 7    0          False
________________________________________________________________
AdaptiveAvgPool2d    10 x 1024 x 1 x 1    0          False
________________________________________________________________
AdaptiveMaxPool2d    10 x 1024 x 1 x 1    0          False
________________________________________________________________
Flatten              10 x 2048            0          False
________________________________________________________________
BatchNorm1d          10 x 2048            4,096      True
________________________________________________________________
Dropout              10 x 2048            0          False
________________________________________________________________
Linear               10 x 512             1,048,576  True
________________________________________________________________
ReLU                 10 x 512             0          False
________________________________________________________________
BatchNorm1d          10 x 512             1,024      True
________________________________________________________________
Dropout              10 x 512             0          False
________________________________________________________________
Linear               10 x 37              18,944     True
________________________________________________________________

Total params: 27,654,496
Total trainable params: 1,072,640
Total non-trainable params: 26,581,856

Optimizer used: &lt;function Adam at 0x7fc1cfc16f28&gt;
Loss function: FlattenedLoss of CrossEntropyLoss()

Model frozen up to parameter group #1

Callbacks:
  - TrainEvalCallback
  - Recorder
  - ProgressCallback</code></pre>

</details><p>And finally, fit:</p>
<pre><code><span><span class="va">learn</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/fit_one_cycle.html">fit_one_cycle</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span></code></pre>
<pre><code>epoch   train_loss   valid_loss   accuracy   error_rate   time
------  -----------  -----------  ---------  -----------  ------
0       1.206384     0.518956     0.847091   0.152909     01:00
1       0.841627     0.411970     0.890392   0.109608     00:58
2       0.657220     0.328548     0.899188   0.100812     00:59
</code></pre>
<p>See results:</p>
<pre><code><span><span class="va">learn</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/show_results.html">show_results</a></span><span class="op">(</span><span class="op">)</span></span></code></pre>
<p>Impressive!</p>
<p><img src="files/darknet.png" height="500" align="center" alt="Mnist"></p>
<div class="section level3">
<h3 id="gan-example">GAN example<a class="anchor" aria-label="anchor" href="#gan-example"></a>
</h3>
<p>Get data (4,4 GB):</p>
<pre><code><span><span class="fu"><a href="reference/URLs_LSUN_BEDROOMS.html">URLs_LSUN_BEDROOMS</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">path</span> <span class="op">=</span> <span class="st">'bedroom'</span></span></code></pre>
<p>Dataloader function:</p>
<pre><code><span><span class="va">get_dls</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">bs</span>, <span class="va">size</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dblock</span> <span class="op">=</span> <span class="fu"><a href="reference/DataBlock.html">DataBlock</a></span><span class="op">(</span>blocks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="reference/TransformBlock.html">TransformBlock</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="reference/ImageBlock.html">ImageBlock</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     get_x <span class="op">=</span> <span class="fu"><a href="reference/generate_noise.html">generate_noise</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                     get_items <span class="op">=</span> <span class="fu"><a href="reference/get_image_files.html">get_image_files</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                     splitter <span class="op">=</span> <span class="fu"><a href="reference/IndexSplitter.html">IndexSplitter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     item_tfms <span class="op">=</span> <span class="fu"><a href="reference/Resize.html">Resize</a></span><span class="op">(</span><span class="va">size</span>, method <span class="op">=</span> <span class="st">"crop"</span><span class="op">)</span>,</span>
<span>                     batch_tfms <span class="op">=</span> <span class="fu"><a href="reference/Normalize_from_stats.html">Normalize_from_stats</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">dblock</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/dataloaders.html">dataloaders</a></span><span class="op">(</span>source <span class="op">=</span> <span class="va">path</span>, path <span class="op">=</span> <span class="va">path</span>,bs <span class="op">=</span> <span class="va">bs</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">dls</span> <span class="op">=</span> <span class="fu"><a href="reference/get_dls.html">get_dls</a></span><span class="op">(</span><span class="fl">128</span>, <span class="fl">64</span><span class="op">)</span></span></code></pre>
<p>Generator and discriminator:</p>
<pre><code><span><span class="va">generator</span> <span class="op">=</span> <span class="fu"><a href="reference/basic_generator.html">basic_generator</a></span><span class="op">(</span>out_size <span class="op">=</span> <span class="fl">64</span>, n_channels <span class="op">=</span> <span class="fl">3</span>, n_extra_layers <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">critic</span>    <span class="op">=</span> <span class="fu"><a href="reference/basic_critic.html">basic_critic</a></span><span class="op">(</span>in_size <span class="op">=</span> <span class="fl">64</span>, n_channels <span class="op">=</span> <span class="fl">3</span>, n_extra_layers <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                    act_cls <span class="op">=</span> <span class="fu"><a href="reference/partial.html">partial</a></span><span class="op">(</span><span class="va">nn</span><span class="op">$</span><span class="va">LeakyReLU</span>, negative_slope <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span></code></pre>
<p>Model:</p>
<pre><code><span><span class="va">learn</span> <span class="op">=</span> <span class="fu"><a href="reference/GANLearner_wgan.html">GANLearner_wgan</a></span><span class="op">(</span><span class="va">dls</span>, <span class="va">generator</span>, <span class="va">critic</span>, opt_func <span class="op">=</span> <span class="fu"><a href="reference/partial.html">partial</a></span><span class="op">(</span><span class="fu"><a href="reference/Adam.html">Adam</a></span><span class="op">(</span><span class="op">)</span>, mom<span class="op">=</span><span class="fl">0.</span><span class="op">)</span><span class="op">)</span></span></code></pre>
<p>And fit:</p>
<pre><code><span><span class="va">learn</span><span class="op">$</span><span class="va">recorder</span><span class="op">$</span><span class="va">train_metrics</span> <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="va">learn</span><span class="op">$</span><span class="va">recorder</span><span class="op">$</span><span class="va">valid_metrics</span> <span class="op">=</span> <span class="cn">FALSE</span></span>
<span></span>
<span><span class="va">learn</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2e-4</span>, wd <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre>
<pre><code>epoch     train_loss  gen_loss  crit_loss  time
0         -0.555554   0.516327  -0.967604  05:06</code></pre>
<p>This is the result for 1 epoch.</p>
<pre><code><span><span class="va">learn</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/show_results.html">show_results</a></span><span class="op">(</span>max_n <span class="op">=</span> <span class="fl">16</span>, figsize <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>,<span class="fl">8</span><span class="op">)</span>, ds_idx<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span></code></pre>
<center>
<p><img src="files/gan.png" height="600" align="center" alt="Mnist"></p>
</center>
</div>
</div>
<div class="section level2">
<h2 id="unet-example">Unet example<a class="anchor" aria-label="anchor" href="#unet-example"></a>
</h2>
<p>Call libraries:</p>
<pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/EagerAI/fastai" class="external-link">fastai</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span></code></pre>
<p>Get data</p>
<pre><code><span><span class="fu"><a href="reference/URLs_CAMVID.html">URLs_CAMVID</a></span><span class="op">(</span><span class="op">)</span></span></code></pre>
<p>Specify folders:</p>
<pre><code><span><span class="va">path</span> <span class="op">=</span> <span class="st">'camvid'</span></span>
<span><span class="va">fnames</span> <span class="op">=</span> <span class="fu"><a href="reference/get_image_files.html">get_image_files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">'images'</span>,sep <span class="op">=</span> <span class="st">'/'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">lbl_names</span> <span class="op">=</span> <span class="fu"><a href="reference/get_image_files.html">get_image_files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">'labels'</span>,sep <span class="op">=</span> <span class="st">'/'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">codes</span> <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">'codes.txt'</span>,sep <span class="op">=</span> <span class="st">'/'</span><span class="op">)</span>, header <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">[[</span><span class="st">'V1'</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">valid_fnames</span> <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">'valid.txt'</span>,sep <span class="op">=</span> <span class="st">'/'</span><span class="op">)</span>,header <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">[[</span><span class="st">'V1'</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co"># batch size</span></span>
<span><span class="va">bs</span> <span class="op">=</span> <span class="fl">8</span></span></code></pre>
<p>Define a loader object:</p>
<pre><code><span><span class="va">camvid</span> <span class="op">=</span> <span class="fu"><a href="reference/DataBlock.html">DataBlock</a></span><span class="op">(</span>blocks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="reference/ImageBlock.html">ImageBlock</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="reference/MaskBlock.html">MaskBlock</a></span><span class="op">(</span><span class="va">codes</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   get_items <span class="op">=</span> <span class="va">get_image_files</span>,</span>
<span>                   splitter <span class="op">=</span> <span class="fu"><a href="reference/FileSplitter.html">FileSplitter</a></span><span class="op">(</span><span class="st">'camvid/valid.txt'</span><span class="op">)</span>,</span>
<span>                   get_y <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'camvid/labels/'</span>,<span class="va">x</span><span class="op">$</span><span class="va">stem</span>,<span class="st">'_P'</span>,<span class="va">x</span><span class="op">$</span><span class="va">suffix</span>,sep <span class="op">=</span> <span class="st">''</span><span class="op">)</span><span class="op">}</span>,</span>
<span>                   batch_tfms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="reference/Normalize_from_stats.html">Normalize_from_stats</a></span><span class="op">(</span> <span class="fu"><a href="reference/imagenet_stats.html">imagenet_stats</a></span><span class="op">(</span><span class="op">)</span> <span class="op">)</span></span>
<span>                   <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># prefix and suffix of the name of the file</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="va">stem</span>; <span class="va">x</span><span class="op">$</span><span class="va">suffix</span></span></code></pre>
<p>Dataloader object and list of labels:</p>
<pre><code><span><span class="va">dls</span> <span class="op">=</span> <span class="va">camvid</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/dataloaders.html">dataloaders</a></span><span class="op">(</span>source <span class="op">=</span> <span class="st">"camvid/images"</span>, bs <span class="op">=</span> <span class="va">bs</span>, path <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dls</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/show_batch.html">show_batch</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">void_code</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">codes</span> <span class="op">==</span> <span class="st">"Void"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dls</span><span class="op">$</span><span class="va">vocab</span> <span class="op">=</span> <span class="va">codes</span></span>
<span></span>
<span><span class="va">name2id</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="reference/length.html">length</a></span><span class="op">(</span><span class="va">codes</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">name2id</span><span class="op">)</span> <span class="op">=</span> <span class="va">codes</span></span></code></pre>
<center>
<p><img src="files/unet.png" height="600" align="center" alt="Mnist"></p>
</center>
<pre><code>str(name2id)
List of 32
 $ Animal           : int 1
 $ Archway          : int 2
 $ Bicyclist        : int 3
 $ Bridge           : int 4
 $ Building         : int 5
 $ Car              : int 6
 $ CartLuggagePram  : int 7
 $ Child            : int 8
 $ Column_Pole      : int 9
 $ Fence            : int 10
 $ LaneMkgsDriv     : int 11
 $ LaneMkgsNonDriv  : int 12
 $ Misc_Text        : int 13
 $ MotorcycleScooter: int 14
 $ OtherMoving      : int 15
 $ ParkingBlock     : int 16
 $ Pedestrian       : int 17
 $ Road             : int 18
 $ RoadShoulder     : int 19
 $ Sidewalk         : int 20
 $ SignSymbol       : int 21
 $ Sky              : int 22
 $ SUVPickupTruck   : int 23
 $ TrafficCone      : int 24
 $ TrafficLight     : int 25
 $ Train            : int 26
 $ Tree             : int 27
 $ Truck_Bus        : int 28
 $ Tunnel           : int 29
 $ VegetationMisc   : int 30
 $ Void             : int 31
 $ Wall             : int 32</code></pre>
<p>Custom accuracy function:</p>
<pre><code><span><span class="va">acc_camvid</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">target</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">target</span> <span class="op">=</span> <span class="va">target</span><span class="op">$</span><span class="fu">squeeze</span><span class="op">(</span><span class="fl">1L</span><span class="op">)</span></span>
<span>  <span class="co"># exclude/filter void label</span></span>
<span>  <span class="va">mask</span> <span class="op">=</span> <span class="va">target</span> <span class="op">!=</span> <span class="va">void_code</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span></span>
<span>    <span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="fu">argmax</span><span class="op">(</span>dim<span class="op">=</span><span class="fl">1L</span><span class="op">)</span><span class="op">[</span><span class="va">mask</span><span class="op">]</span><span class="op">$</span><span class="fu">eq</span><span class="op">(</span><span class="va">target</span><span class="op">[</span><span class="va">mask</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="reference/float.html">float</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">acc_camvid</span>, <span class="st">"py_function_name"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">'acc_camvid'</span></span></code></pre>
<details><summary>
Debug acc_camvid manually
</summary><p>
</p>
<pre><code><span><span class="va">batch</span> <span class="op">=</span> <span class="va">dls</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/one_batch.html">one_batch</a></span><span class="op">(</span>convert <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre>
<pre><code>[[1]]
TensorImage([[[[-1.4419e+00, -1.3117e+00, -1.1976e+00,  ...,  2.2489e+00,
            2.2238e+00,  2.0948e+00],
          [-1.5401e+00, -1.5213e+00, -1.4010e+00,  ...,  1.9834e+00,
            2.2378e+00,  2.2173e+00],
          [-1.6401e+00, -1.5477e+00, -1.5588e+00,  ...,  9.1953e-01,
            1.9501e+00,  1.1138e+00],
          ...,
          [-1.6852e+00, -1.5440e+00, -1.5132e+00,  ..., -1.0596e+00,
           -1.0711e+00, -1.0674e+00],
          [-1.5265e+00, -1.6030e+00, -1.5804e+00,  ..., -1.0268e+00,
           -1.0946e+00, -1.1181e+00],
          [-1.5423e+00, -1.5516e+00, -1.6014e+00,  ..., -1.1734e+00,
           -1.1293e+00, -1.0777e+00]],

         [[-1.3446e+00, -1.2023e+00, -1.0470e+00,  ...,  2.4286e+00,
            2.4090e+00,  2.2977e+00],
          [-1.4481e+00, -1.4276e+00, -1.2930e+00,  ...,  2.1422e+00,
            2.4158e+00,  2.3778e+00],
          [-1.5607e+00, -1.4584e+00, -1.4641e+00,  ...,  1.0026e+00,
            2.0258e+00,  1.1376e+00],
          ...,
          [-1.5809e+00, -1.4399e+00, -1.4133e+00,  ..., -7.8931e-01,
           -7.9807e-01, -7.9637e-01],
          [-1.4161e+00, -1.4909e+00, -1.4646e+00,  ..., -8.0615e-01,
           -8.5201e-01, -8.5311e-01],
          [-1.4472e+00, -1.4567e+00, -1.5077e+00,  ..., -9.4607e-01,
           -8.9744e-01, -8.2074e-01]],

         [[-1.1164e+00, -1.0162e+00, -9.1189e-01,  ...,  2.6257e+00,
            2.5726e+00,  2.4016e+00],
          [-1.2195e+00, -1.1752e+00, -1.0595e+00,  ...,  2.3488e+00,
            2.6271e+00,  2.5764e+00],
          [-1.3316e+00, -1.2451e+00, -1.2400e+00,  ...,  1.0476e+00,
            2.1812e+00,  1.3635e+00],
          ...,
          [-1.2881e+00, -1.1393e+00, -1.1035e+00,  ..., -3.8940e-01,
           -4.0598e-01, -3.9861e-01],
          [-1.1427e+00, -1.2167e+00, -1.1906e+00,  ..., -3.6462e-01,
           -4.3055e-01, -4.5333e-01],
          [-1.1525e+00, -1.1651e+00, -1.2190e+00,  ..., -4.8259e-01,
           -4.3712e-01, -4.1413e-01]]],


        [[[-2.0552e-01,  3.9563e-01,  4.0691e-01,  ..., -9.7342e-01,
           -7.8957e-01, -7.6035e-01],
          [-3.8852e-01,  4.2912e-01,  4.4469e-01,  ..., -1.0449e+00,
           -8.5347e-01, -7.5299e-01],
          [ 3.5939e-01,  3.6353e-01,  4.7028e-01,  ..., -9.3101e-01,
           -8.7398e-01, -7.9327e-01],
          ...,
          [-1.0510e+00, -1.0661e+00, -9.6690e-01,  ..., -1.3688e+00,
           -1.4543e+00, -1.4645e+00],
          [-1.0578e+00, -1.0939e+00, -9.3117e-01,  ..., -1.3939e+00,
           -1.4033e+00, -1.4209e+00],
          [-9.9012e-01, -1.0312e+00, -1.0074e+00,  ..., -1.4274e+00,
           -1.3829e+00, -1.3758e+00]],

         [[ 6.0090e-02,  7.8124e-01,  7.5145e-01,  ..., -8.2881e-01,
           -6.7773e-01, -6.3718e-01],
          [-1.7114e-01,  7.8613e-01,  7.8531e-01,  ..., -9.0003e-01,
           -7.3661e-01, -5.8707e-01],
          [ 7.3440e-01,  7.5691e-01,  8.2297e-01,  ..., -8.0694e-01,
           -7.5451e-01, -6.2783e-01],
          ...,
          [-7.8971e-01, -7.8585e-01, -7.4870e-01,  ..., -1.2630e+00,
           -1.3108e+00, -1.3046e+00],
          [-7.8414e-01, -7.9617e-01, -7.2847e-01,  ..., -1.2297e+00,
           -1.2414e+00, -1.2594e+00],
          [-7.3135e-01, -7.7442e-01, -7.4849e-01,  ..., -1.2259e+00,
           -1.1889e+00, -1.2022e+00]],

         [[ 4.4920e-01,  1.2392e+00,  1.3399e+00,  ..., -6.0991e-01,
           -4.5250e-01, -4.4251e-01],
          [ 2.7577e-01,  1.2913e+00,  1.3755e+00,  ..., -6.8060e-01,
           -5.1114e-01, -3.7442e-01],
          [ 1.0632e+00,  1.3052e+00,  1.3774e+00,  ..., -5.8343e-01,
           -5.2787e-01, -3.9803e-01],
          ...,
          [-4.4165e-01, -4.4558e-01, -3.8942e-01,  ..., -8.7048e-01,
           -9.2835e-01, -9.2750e-01],
          [-4.4233e-01, -4.6348e-01, -3.7176e-01,  ..., -8.6960e-01,
           -8.8080e-01, -8.9788e-01],
          [-3.8967e-01, -4.3118e-01, -3.8587e-01,  ..., -8.7933e-01,
           -8.4775e-01, -8.5052e-01]]],


        [[[ 1.2805e+00,  2.2139e+00,  9.9765e-01,  ...,  6.6338e-01,
           -4.0192e-01,  2.8007e-01],
          [ 1.0171e+00,  1.8849e+00,  1.1654e+00,  ..., -1.0001e+00,
            1.1788e+00,  2.0717e+00],
          [ 2.8709e-01,  1.9494e+00,  2.1978e+00,  ..., -6.7389e-01,
            3.2762e-01,  4.5549e-01],
          ...,
          [-4.3609e-01, -4.2635e-01, -4.6298e-01,  ...,  7.7548e-02,
            3.6271e-02, -3.1759e-02],
          [-3.7265e-01, -4.3453e-01, -4.4666e-01,  ..., -7.5601e-02,
            5.3570e-03, -2.9393e-02],
          [-3.7581e-01, -4.0105e-01, -4.2908e-01,  ...,  8.5172e-03,
           -3.3988e-03, -1.8303e-02]],

         [[ 1.3276e+00,  2.3720e+00,  1.0603e+00,  ...,  8.6043e-01,
           -1.1662e-01,  5.2147e-01],
          [ 1.0938e+00,  2.0233e+00,  1.2629e+00,  ..., -9.1610e-01,
            1.3807e+00,  2.2914e+00],
          [ 3.8840e-01,  2.1078e+00,  2.3635e+00,  ..., -5.8584e-01,
            5.2653e-01,  7.8300e-01],
          ...,
          [-3.1636e-01, -3.0640e-01, -3.4385e-01,  ...,  1.3784e-01,
            9.5460e-02,  2.5607e-02],
          [-2.5150e-01, -3.1476e-01, -3.2716e-01,  ..., -1.9409e-02,
            6.3717e-02,  2.8037e-02],
          [-2.5473e-01, -2.8054e-01, -3.0920e-01,  ...,  6.6963e-02,
            5.4727e-02,  3.9424e-02]],

         [[ 1.8118e+00,  2.6126e+00,  1.5284e+00,  ...,  1.3408e+00,
            3.8263e-01,  9.4347e-01],
          [ 1.4345e+00,  2.2263e+00,  1.5055e+00,  ..., -4.0407e-01,
            1.9165e+00,  2.5325e+00],
          [ 6.9120e-01,  2.3214e+00,  2.5724e+00,  ..., -5.9273e-02,
            7.6707e-01,  9.8036e-01],
          ...,
          [-3.2707e-02, -2.5592e-02, -6.5520e-02,  ...,  3.1733e-01,
            2.8317e-01,  2.2166e-01],
          [ 1.6474e-02, -4.1773e-02, -5.1314e-02,  ...,  1.6267e-01,
            2.4836e-01,  2.1449e-01],
          [ 2.4832e-02,  1.0270e-02, -1.5259e-02,  ...,  2.3768e-01,
            2.2930e-01,  2.2220e-01]]],


        ...,


        [[[-1.5176e-02, -1.9729e-02, -5.4177e-02,  ...,  2.0812e+00,
            2.2489e+00,  2.2242e+00],
          [-1.0897e-02,  3.5695e-02,  2.3053e-03,  ...,  2.1605e+00,
            2.0372e+00,  2.1403e+00],
          [-2.8262e-02, -3.0313e-02, -3.4347e-02,  ...,  2.2136e+00,
            2.2489e+00,  1.2613e+00],
          ...,
          [-1.2644e+00, -1.2548e+00, -1.2313e+00,  ..., -1.3335e+00,
           -1.3230e+00, -1.2787e+00],
          [-1.1986e+00, -1.2068e+00, -1.1631e+00,  ..., -1.2694e+00,
           -1.2973e+00, -1.2696e+00],
          [-1.2508e+00, -1.2447e+00, -1.2294e+00,  ..., -1.0572e+00,
           -1.0660e+00, -1.0694e+00]],

         [[ 2.2227e-01,  2.1430e-01,  2.1605e-01,  ...,  2.3389e+00,
            2.4286e+00,  2.4286e+00],
          [ 2.0176e-01,  2.4693e-01,  2.4092e-01,  ...,  2.3745e+00,
            2.2931e+00,  2.3820e+00],
          [ 1.8103e-01,  1.7892e-01,  1.7477e-01,  ...,  2.4036e+00,
            2.4286e+00,  1.4878e+00],
          ...,
          [-1.0710e+00, -1.0613e+00, -1.0374e+00,  ..., -1.2492e+00,
           -1.2385e+00, -1.2225e+00],
          [-1.0040e+00, -1.0124e+00, -9.6780e-01,  ..., -1.1836e+00,
           -1.2122e+00, -1.2193e+00],
          [-1.0572e+00, -1.0510e+00, -1.0354e+00,  ..., -9.5631e-01,
           -9.6512e-01, -9.6444e-01]],

         [[ 5.4786e-01,  5.5583e-01,  5.3839e-01,  ...,  2.5781e+00,
            2.6400e+00,  2.6400e+00],
          [ 5.3558e-01,  5.8483e-01,  5.6649e-01,  ...,  2.5895e+00,
            2.5283e+00,  2.6400e+00],
          [ 5.2345e-01,  5.2294e-01,  5.1033e-01,  ...,  2.6400e+00,
            2.6400e+00,  1.7087e+00],
          ...,
          [-8.1354e-01, -8.0387e-01, -7.9721e-01,  ..., -1.0014e+00,
           -9.9075e-01, -9.5806e-01],
          [-7.4687e-01, -7.5518e-01, -7.2870e-01,  ..., -9.4173e-01,
           -9.6991e-01, -9.5030e-01],
          [-7.9981e-01, -7.9358e-01, -7.9630e-01,  ..., -7.3474e-01,
           -7.4333e-01, -7.3628e-01]]],


        [[[ 6.8056e-01,  6.8056e-01,  6.9105e-01,  ..., -3.6921e-01,
           -3.1641e-01, -3.3400e-01],
          [ 6.9991e-01,  7.1771e-01,  6.8056e-01,  ..., -3.3319e-01,
           -3.4023e-01, -3.8674e-01],
          [ 6.9781e-01,  7.1034e-01,  6.9885e-01,  ..., -2.9567e-01,
           -3.0638e-01, -2.8775e-01],
          ...,
          [-1.4393e+00, -1.4183e+00, -1.4183e+00,  ..., -1.3420e+00,
           -1.4022e+00, -1.3872e+00],
          [-1.4436e+00, -1.4326e+00, -1.4335e+00,  ..., -1.3950e+00,
           -1.3800e+00, -1.3734e+00],
          [-1.4509e+00, -1.4539e+00, -1.4533e+00,  ..., -1.3681e+00,
           -1.4340e+00, -1.3650e+00]],

         [[ 2.0471e+00,  2.0471e+00,  2.0603e+00,  ..., -6.5347e-02,
            2.6326e-02,  3.4833e-02],
          [ 2.0525e+00,  2.0750e+00,  2.0818e+00,  ..., -4.7675e-02,
           -5.2935e-03, -2.6855e-02],
          [ 2.0976e+00,  2.1136e+00,  2.1051e+00,  ...,  1.8606e-02,
            4.1052e-02,  8.5274e-02],
          ...,
          [-1.2304e+00, -1.2244e+00, -1.2219e+00,  ..., -1.2425e+00,
           -1.3041e+00, -1.2836e+00],
          [-1.2239e+00, -1.2107e+00, -1.2107e+00,  ..., -1.2967e+00,
           -1.2813e+00, -1.2746e+00],
          [-1.2210e+00, -1.2154e+00, -1.2157e+00,  ..., -1.2695e+00,
           -1.3401e+00, -1.2696e+00]],

         [[ 2.6400e+00,  2.6400e+00,  2.6400e+00,  ...,  3.4950e-01,
            4.4111e-01,  4.1667e-01],
          [ 2.6400e+00,  2.6400e+00,  2.6400e+00,  ...,  3.3850e-01,
            3.8055e-01,  3.7792e-01],
          [ 2.6400e+00,  2.6400e+00,  2.6400e+00,  ...,  4.4053e-01,
            4.5217e-01,  4.8598e-01],
          ...,
          [-8.2900e-01, -8.1651e-01, -8.1498e-01,  ..., -9.5577e-01,
           -1.0173e+00, -9.9684e-01],
          [-8.3432e-01, -8.2192e-01, -8.2227e-01,  ..., -1.0234e+00,
           -1.0080e+00, -1.0014e+00],
          [-8.3237e-01, -8.2912e-01, -8.2936e-01,  ..., -1.0039e+00,
           -1.0649e+00, -9.9452e-01]]],


        [[[ 2.0699e+00,  1.9477e+00,  2.0700e+00,  ..., -1.5310e+00,
           -1.6490e+00, -1.6860e+00],
          [ 1.8292e+00,  2.1599e+00,  1.8882e+00,  ..., -1.6536e+00,
           -1.6374e+00, -1.6022e+00],
          [ 2.0288e+00,  1.7863e+00,  2.0564e+00,  ..., -1.6149e+00,
           -1.6315e+00, -1.5586e+00],
          ...,
          [-1.4481e+00, -1.3921e+00, -1.4195e+00,  ..., -1.5045e+00,
           -1.5133e+00, -1.5381e+00],
          [-1.4223e+00, -1.3757e+00, -1.3943e+00,  ..., -1.5238e+00,
           -1.5371e+00, -1.5453e+00],
          [-1.4134e+00, -1.4104e+00, -1.4300e+00,  ..., -1.5163e+00,
           -1.5862e+00, -1.5565e+00]],

         [[ 1.5571e+00,  1.4284e+00,  1.8346e+00,  ..., -1.4521e+00,
           -1.6496e+00, -1.6908e+00],
          [ 1.2790e+00,  1.6710e+00,  1.3942e+00,  ..., -1.5838e+00,
           -1.6467e+00, -1.6069e+00],
          [ 1.4661e+00,  1.2568e+00,  1.7123e+00,  ..., -1.5898e+00,
           -1.6761e+00, -1.6212e+00],
          ...,
          [-1.2567e+00, -1.2393e+00, -1.2457e+00,  ..., -1.4077e+00,
           -1.4073e+00, -1.4286e+00],
          [-1.2191e+00, -1.2129e+00, -1.2214e+00,  ..., -1.4193e+00,
           -1.4265e+00, -1.4403e+00],
          [-1.2213e+00, -1.2350e+00, -1.2495e+00,  ..., -1.4075e+00,
           -1.4811e+00, -1.4504e+00]],

         [[ 1.1398e+00,  1.0327e+00,  1.4135e+00,  ..., -1.2147e+00,
           -1.4180e+00, -1.4598e+00],
          [ 8.6931e-01,  1.2768e+00,  1.0129e+00,  ..., -1.3449e+00,
           -1.3906e+00, -1.3518e+00],
          [ 1.1199e+00,  9.0534e-01,  1.2758e+00,  ..., -1.3922e+00,
           -1.4662e+00, -1.4051e+00],
          ...,
          [-8.5999e-01, -8.2594e-01, -8.6729e-01,  ..., -1.0699e+00,
           -1.0976e+00, -1.1388e+00],
          [-8.4630e-01, -8.2145e-01, -8.4266e-01,  ..., -1.1058e+00,
           -1.1325e+00, -1.1478e+00],
          [-8.5198e-01, -8.5977e-01, -8.7435e-01,  ..., -1.1186e+00,
           -1.1739e+00, -1.1579e+00]]]], device='cuda:0')

[[2]]
TensorMask([[[ 4,  4,  4,  ...,  4,  4,  4],
         [ 4,  4,  4,  ...,  4,  4,  4],
         [ 4,  4,  4,  ...,  4,  4,  4],
         ...,
         [19, 19, 19,  ..., 17, 17, 17],
         [19, 19, 19,  ..., 17, 17, 17],
         [19, 19, 19,  ..., 17, 17, 17]],

        [[ 4,  4,  4,  ...,  4,  4,  4],
         [ 4,  4,  4,  ...,  4,  4,  4],
         [ 4,  4,  4,  ...,  4,  4,  4],
         ...,
         [17, 17, 17,  ..., 17, 17, 17],
         [17, 17, 17,  ..., 17, 17, 17],
         [17, 17, 17,  ..., 17, 17, 17]],

        [[26, 21, 26,  ..., 26, 26, 26],
         [26, 21, 26,  ..., 26, 26, 26],
         [26, 21, 21,  ..., 26, 26, 26],
         ...,
         [17, 17, 17,  ..., 17, 17, 17],
         [17, 17, 17,  ..., 17, 17, 17],
         [17, 17, 17,  ..., 17, 17, 17]],

        ...,

        [[ 4,  4,  4,  ..., 26, 26, 26],
         [ 4,  4,  4,  ..., 26, 26, 26],
         [ 4,  4,  4,  ..., 26, 26, 26],
         ...,
         [17, 17, 17,  ..., 19, 19, 19],
         [17, 17, 17,  ..., 19, 19, 19],
         [17, 17, 17,  ..., 19, 19, 19]],

        [[21, 21, 21,  ...,  4,  4,  4],
         [21, 21, 21,  ...,  4,  4,  4],
         [21, 21, 21,  ...,  4,  4,  4],
         ...,
         [17, 17, 17,  ..., 19, 19, 19],
         [17, 17, 17,  ..., 19, 19, 19],
         [17, 17, 17,  ..., 19, 19, 19]],

        [[ 4,  4,  4,  ..., 30, 30, 30],
         [ 4,  4,  4,  ..., 30, 30, 30],
         [ 4,  4,  4,  ..., 30, 30, 30],
         ...,
         [17, 17, 17,  ..., 17, 17, 17],
         [17, 17, 17,  ..., 17, 17, 17],
         [17, 17, 17,  ..., 17, 17, 17]]], device='cuda:0')</code></pre>
<p>The shape of the tensors:</p>
<pre><code><span><span class="va">batch</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">shape</span>;<span class="va">batch</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">shape</span></span></code></pre>
<pre><code>torch.Size([8, 3, 200, 266])
torch.Size([8, 200, 266])</code></pre>
<p>Define input and target:</p>
<pre><code><span><span class="va">input</span> <span class="op">=</span> <span class="va">batch</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">target</span> <span class="op">=</span> <span class="va">batch</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></code></pre>
<p>Filter Void class:</p>
<pre><code><span><span class="va">mask</span> <span class="op">=</span> <span class="va">target</span> <span class="op">!=</span> <span class="va">void_code</span></span></code></pre>
<p><code>31</code> will be filtered as <code>False</code>:</p>
<pre><code>TensorMask([[[True, True, True,  ..., True, True, True],
         [True, True, True,  ..., True, True, True],
         [True, True, True,  ..., True, True, True],
         ...,
         [True, True, True,  ..., True, True, True],
         [True, True, True,  ..., True, True, True],
         [True, True, True,  ..., True, True, True]],

        [[True, True, True,  ..., True, True, True],
         [True, True, True,  ..., True, True, True],
         [True, True, True,  ..., True, True, True],
         ...,
         [True, True, True,  ..., True, True, True],
         [True, True, True,  ..., True, True, True],
         [True, True, True,  ..., True, True, True]],

        [[True, True, True,  ..., True, True, True],
         [True, True, True,  ..., True, True, True],
         [True, True, True,  ..., True, True, True],
         ...,
         [True, True, True,  ..., True, True, True],
         [True, True, True,  ..., True, True, True],
         [True, True, True,  ..., True, True, True]],

        ...,

        [[True, True, True,  ..., True, True, True],
         [True, True, True,  ..., True, True, True],
         [True, True, True,  ..., True, True, True],
         ...,
         [True, True, True,  ..., True, True, True],
         [True, True, True,  ..., True, True, True],
         [True, True, True,  ..., True, True, True]],

        [[True, True, True,  ..., True, True, True],
         [True, True, True,  ..., True, True, True],
         [True, True, True,  ..., True, True, True],
         ...,
         [True, True, True,  ..., True, True, True],
         [True, True, True,  ..., True, True, True],
         [True, True, True,  ..., True, True, True]],

        [[True, True, True,  ..., True, True, True],
         [True, True, True,  ..., True, True, True],
         [True, True, True,  ..., True, True, True],
         ...,
         [True, True, True,  ..., True, True, True],
         [True, True, True,  ..., True, True, True],
         [True, True, True,  ..., True, True, True]]], device='cuda:0')</code></pre>
<pre><code>&gt; (input$argmax(dim=1L)[mask] == target[mask])
tensor([False, False, False,  ..., False, False, False], device='cuda:0')</code></pre>
<pre><code>&gt; (input$argmax(dim=1L)[mask] == target[mask]) %&gt;%
              float()
tensor([0., 0., 0.,  ..., 0., 0., 0.], device='cuda:0')</code></pre>
<pre><code>&gt; (input$argmax(dim=1L)[mask]==target[mask]) %&gt;%
              float() %&gt;% mean()
tensor(0.0011, device='cuda:0')</code></pre>

</details><p>Resnet34 model architecture for unet:</p>
<pre><code><span><span class="va">learn</span> <span class="op">=</span> <span class="fu"><a href="reference/unet_learner.html">unet_learner</a></span><span class="op">(</span><span class="va">dls</span>, <span class="fu"><a href="reference/resnet34.html">resnet34</a></span><span class="op">(</span><span class="op">)</span>, metrics <span class="op">=</span> <span class="va">acc_camvid</span><span class="op">)</span></span></code></pre>
<p>And finally, fit:</p>
<pre><code><span><span class="va">lr</span> <span class="op">=</span> <span class="fl">3e-3</span></span>
<span><span class="va">wd</span> <span class="op">=</span> <span class="fl">1e-2</span></span>
<span></span>
<span><span class="va">learn</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/fit_one_cycle.html">fit_one_cycle</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fu"><a href="reference/slice.html">slice</a></span><span class="op">(</span><span class="va">lr</span><span class="op">)</span>, pct_start <span class="op">=</span> <span class="fl">0.9</span>, wd <span class="op">=</span> <span class="va">wd</span><span class="op">)</span></span></code></pre>
<pre><code>epoch     train_loss  valid_loss  acc_camvid  time
0         1.367869    1.239496    0.666145    00:25
1         0.929434    0.661407    0.839969    00:23</code></pre>
<pre><code><span><span class="va">learn</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/show_results.html">show_results</a></span><span class="op">(</span>max_n <span class="op">=</span> <span class="fl">1</span>, figsize <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">10</span><span class="op">)</span>, vmin <span class="op">=</span> <span class="fl">1</span>, vmax <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span></code></pre>
<p><img src="files/unetres.png" height="500" align="center" alt="lr"></p>
</div>
<div class="section level2">
<h2 id="collab-collaborative-filtering">Collab (Collaborative filtering)<a class="anchor" aria-label="anchor" href="#collab-collaborative-filtering"></a>
</h2>
<p>Call libraries:</p>
<pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nteetor/zeallot" class="external-link">zeallot</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span></code></pre>
<p>Get data:</p>
<pre><code><span><span class="fu"><a href="reference/URLs_MOVIE_LENS_ML_100k.html">URLs_MOVIE_LENS_ML_100k</a></span><span class="op">(</span><span class="op">)</span></span></code></pre>
<p>Specify column names:</p>
<pre><code><span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">user</span>,<span class="va">item</span>,<span class="va">title</span><span class="op">)</span>  <span class="op"><a href="https://rdrr.io/pkg/zeallot/man/operator.html" class="external-link">%&lt;-%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">'userId'</span>,<span class="st">'movieId'</span>,<span class="st">'title'</span><span class="op">)</span></span></code></pre>
<p>Read datasets:</p>
<pre><code><span><span class="va">ratings</span> <span class="op">=</span> <span class="fu">fread</span><span class="op">(</span><span class="st">'ml-100k/u.data'</span>, col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">user</span>,<span class="va">item</span>,<span class="st">'rating'</span>,<span class="st">'timestamp'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">movies</span> <span class="op">=</span> <span class="fu">fread</span><span class="op">(</span><span class="st">'ml-100k/u.item'</span>, col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">item</span>, <span class="st">'title'</span>, <span class="st">'date'</span>, <span class="st">'N'</span>, <span class="st">'url'</span>,</span>
<span>                                                           <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'g'</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">19</span>,sep <span class="op">=</span> <span class="st">''</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre>
<p>Left join on item:</p>
<pre><code><span><span class="va">rating_movie</span> <span class="op">=</span> <span class="va">ratings</span><span class="op">[</span><span class="va">movies</span><span class="op">[</span>, <span class="va">.SD</span>, .SDcols<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">item</span>,<span class="va">title</span><span class="op">)</span><span class="op">]</span>, on <span class="op">=</span> <span class="va">item</span><span class="op">]</span></span></code></pre>
<p>Load data from dataframe (R):</p>
<pre><code><span><span class="va">dls</span> <span class="op">=</span> <span class="fu"><a href="reference/CollabDataLoaders_from_df.html">CollabDataLoaders_from_df</a></span><span class="op">(</span><span class="va">rating_movie</span>, seed<span class="op">=</span><span class="fl">42</span>, valid_pct<span class="op">=</span><span class="fl">0.1</span>, bs<span class="op">=</span><span class="fl">64</span>, item_name<span class="op">=</span><span class="va">title</span>, path<span class="op">=</span><span class="st">'ml-100k'</span><span class="op">)</span></span></code></pre>
<p>Build model:</p>
<pre><code><span><span class="va">learn</span> <span class="op">=</span> <span class="fu"><a href="reference/collab_learner.html">collab_learner</a></span><span class="op">(</span><span class="va">dls</span>, n_factors <span class="op">=</span> <span class="fl">40</span>, y_range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5.5</span><span class="op">)</span><span class="op">)</span></span></code></pre>
<p>Start learning:</p>
<pre><code><span><span class="va">learn</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/fit_one_cycle.html">fit_one_cycle</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5e-3</span>,  wd <span class="op">=</span> <span class="fl">1e-1</span><span class="op">)</span></span></code></pre>
<p>Get top 1,000 movies:</p>
<pre><code><span><span class="va">top_movies</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">rating_movie</span><span class="op">[</span> , <span class="va">count</span> <span class="op">:=</span> <span class="va">.N</span>, by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">title</span><span class="op">)</span><span class="op">]</span></span>
<span>                    <span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">count</span>,decreasing <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">]</span></span>
<span>                    <span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'title'</span>,<span class="st">'count'</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                   <span class="fl">1e3</span><span class="op">)</span><span class="op">[[</span><span class="st">'title'</span><span class="op">]</span><span class="op">]</span></span></code></pre>
<p>Find mean ratings for the films:</p>
<pre><code><span><span class="va">mean_ratings</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">rating_movie</span><span class="op">[</span> , <span class="fu">.</span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rating</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">title</span><span class="op">]</span><span class="op">)</span></span></code></pre>
<pre><code>                                          title     mean
   1:                          Toy Story (1995) 3.878319
   2:                          GoldenEye (1995) 3.206107
   3:                         Four Rooms (1995) 3.033333
   4:                         Get Shorty (1995) 3.550239
   5:                            Copycat (1995) 3.302326
  ---
1660:                      Sweet Nothing (1995) 3.000000
1661:                         Mat' i syn (1997) 1.000000
1662:                          B. Monkey (1998) 3.000000
1663:                       You So Crazy (1994) 3.000000
1664: Scream of Stone (Schrei aus Stein) (1991) 3.000000</code></pre>
<p>Extract bias:</p>
<pre><code><span><span class="va">movie_bias</span> <span class="op">=</span> <span class="va">learn</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/get_bias.html">get_bias</a></span><span class="op">(</span><span class="va">top_movies</span>, is_item <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">=</span> <span class="fu">data.table</span><span class="op">(</span>bias <span class="op">=</span> <span class="va">movie_bias</span>,</span>
<span>           title <span class="op">=</span> <span class="va">top_movies</span><span class="op">)</span></span>
<span></span>
<span><span class="va">res</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">result</span>, <span class="va">mean_ratings</span>, all.y <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">res</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">bias</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span></span></code></pre>
<pre><code>                                           title        bias     mean
   1:                           Star Wars (1977)  0.29479960 4.358491
   2:                               Fargo (1996)  0.25264889 4.155512
   3:                      Godfather, The (1972)  0.23247446 4.283293
   4:           Silence of the Lambs, The (1991)  0.22765337 4.289744
   5:                             Titanic (1997)  0.22353025 4.245714
  ---
 996: Children of the Corn: The Gathering (1996) -0.05671900 1.315789
 997:                       Jungle2Jungle (1997) -0.05957306 2.439394
 998:                  Leave It to Beaver (1997) -0.06268980 1.840909
 999:             Speed 2: Cruise Control (1997) -0.06567496 2.131579
1000:           Island of Dr. Moreau, The (1996) -0.07530680 2.157895</code></pre>
<p>Get weights:</p>
<pre><code><span><span class="va">movie_w</span> <span class="op">=</span> <span class="va">learn</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/get_weights.html">get_weights</a></span><span class="op">(</span><span class="va">top_movies</span>, is_item <span class="op">=</span> <span class="cn">TRUE</span>, convert <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
<p>Visualize with highcharter:</p>
<pre><code><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">movie_w</span><span class="op">)</span> <span class="op">=</span> <span class="va">res</span><span class="op">$</span><span class="va">title</span></span>
<span></span>
<span><span class="fu">highcharter</span><span class="fu">::</span><span class="fu"><a href="https://jkunst.com/highcharter/reference/hchart.html" class="external-link">hchart</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/princomp.html" class="external-link">princomp</a></span><span class="op">(</span><span class="va">movie_w</span>, cor <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">highcharter</span><span class="fu">::</span><span class="fu"><a href="https://jkunst.com/highcharter/reference/hc_legend.html" class="external-link">hc_legend</a></span><span class="op">(</span>enabled <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre>
<p><img src="files/pca.png" height="500" align="center" alt="PCA"></p>
</div>
<div class="section level2">
<h2 id="text-data">Text data<a class="anchor" aria-label="anchor" href="#text-data"></a>
</h2>
<p>Grab data:</p>
<pre><code><span><span class="fu"><a href="reference/URLs_IMDB.html">URLs_IMDB</a></span><span class="op">(</span><span class="op">)</span></span></code></pre>
<p>Specify path and small batch_size because it consumes a lot of GPU:</p>
<pre><code><span><span class="va">path</span> <span class="op">=</span> <span class="st">'imdb'</span></span>
<span><span class="va">bs</span> <span class="op">=</span> <span class="fl">20</span></span></code></pre>
<p>Create datablock and iterator:</p>
<pre><code><span><span class="va">imdb_lm</span> <span class="op">=</span> <span class="fu"><a href="reference/DataBlock.html">DataBlock</a></span><span class="op">(</span>blocks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="reference/TextBlock_from_folder.html">TextBlock_from_folder</a></span><span class="op">(</span><span class="va">path</span>, is_lm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                    get_items <span class="op">=</span> <span class="fu"><a href="reference/partial.html">partial</a></span><span class="op">(</span><span class="fu"><a href="reference/get_text_files.html">get_text_files</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                    folders <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'train'</span>, <span class="st">'test'</span>, <span class="st">'unsup'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                    splitter <span class="op">=</span> <span class="fu"><a href="reference/RandomSplitter.html">RandomSplitter</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dbunch_lm</span> <span class="op">=</span> <span class="va">imdb_lm</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/dataloaders.html">dataloaders</a></span><span class="op">(</span>source <span class="op">=</span> <span class="va">path</span>, path <span class="op">=</span> <span class="va">path</span>, bs <span class="op">=</span> <span class="va">bs</span>, seq_len <span class="op">=</span> <span class="fl">80</span><span class="op">)</span></span></code></pre>
<p>Load a pretrained model and fit:</p>
<pre><code><span><span class="va">learn</span> <span class="op">=</span> <span class="fu"><a href="reference/language_model_learner.html">language_model_learner</a></span><span class="op">(</span><span class="va">dbunch_lm</span>, <span class="fu"><a href="reference/AWD_LSTM.html">AWD_LSTM</a></span><span class="op">(</span><span class="op">)</span>, drop_mult <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>                               metrics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">accuracy</span>, <span class="fu"><a href="reference/Perplexity.html">Perplexity</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">learn</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/fit_one_cycle.html">fit_one_cycle</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2e-2</span>, moms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span></span></code></pre>
<blockquote>
<p>Note: <a href="https://github.com/fastai/fastai/issues/1439" class="external-link">AWD_LSTM() can throw an error</a>. In this case find and clean “.fastai” folder.</p>
</blockquote>
</div>
<div class="section level2">
<h2 id="medical-data">Medical data<a class="anchor" aria-label="anchor" href="#medical-data"></a>
</h2>
<p><a href="https://www.kaggle.com/c/rsna-intracranial-hemorrhage-detection/overview" class="external-link">Import dicom data</a>:</p>
<pre><code><span><span class="va">img</span> <span class="op">=</span> <span class="fu"><a href="reference/dcmread.html">dcmread</a></span><span class="op">(</span><span class="st">'hemorrhage.dcm'</span><span class="op">)</span></span></code></pre>
<p>Visualize data with different <a href="https://radiopaedia.org/articles/windowing-ct" class="external-link">windowing effects</a>:</p>
<pre><code><span><span class="va">dicom_windows</span> <span class="op">=</span> <span class="fu"><a href="reference/dicom_windows.html">dicom_windows</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">scale</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="va">dicom_windows</span><span class="op">$</span><span class="va">brain</span>, <span class="va">dicom_windows</span><span class="op">$</span><span class="va">subdural</span><span class="op">)</span></span>
<span><span class="va">titles</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'raw'</span>,<span class="st">'normalized'</span>,<span class="st">'brain windowed'</span>,<span class="st">'subdural windowed'</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nteetor/zeallot" class="external-link">zeallot</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fig</span>, <span class="va">axs</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/zeallot/man/operator.html" class="external-link">%&lt;-%</a></span> <span class="fu"><a href="reference/subplots.html">subplots</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">img</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/show.html">show</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="va">scale</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>               ax <span class="op">=</span> <span class="va">axs</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>               title<span class="op">=</span><span class="va">titles</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">img</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/plot.html">plot</a></span><span class="op">(</span>dpi <span class="op">=</span> <span class="fl">250</span><span class="op">)</span></span></code></pre>
<p align="center">
<img src="files/brain.png" height="500" align="center" alt="dicom"></p>
<p>Apply different cmaps:</p>
<pre><code><span><span class="va">img</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/show.html">show</a></span><span class="op">(</span>cmap <span class="op">=</span> <span class="fu"><a href="reference/cm.html">cm</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">gist_ncar</span>, figsize <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">img</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/plot.html">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre>
<p align="center">
<img src="files/cmap.png" height="500" align="center" alt="dicom"></p>
<p>Or get dcm matrix and plot with ggplot:</p>
<pre><code><span><span class="va">types</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'raw'</span>, <span class="st">'normalized'</span>, <span class="st">'brain'</span>, <span class="st">'subdural'</span><span class="op">)</span></span>
<span><span class="va">p_</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span> <span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="reference/length.html">length</a></span><span class="op">(</span><span class="va">types</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">p</span> <span class="op">=</span> <span class="fu">nandb</span><span class="fu">::</span><span class="fu"><a href="https://rorynolan.github.io/nandb/reference/matrix_raster_plot.html" class="external-link">matrix_raster_plot</a></span><span class="op">(</span><span class="va">img</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/get_dcm_matrix.html">get_dcm_matrix</a></span><span class="op">(</span>type <span class="op">=</span> <span class="va">types</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">p_</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="va">p</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span><span class="va">p_</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">p_</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, <span class="va">p_</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, <span class="va">p_</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>, labels <span class="op">=</span> <span class="va">types</span><span class="op">)</span></span></code></pre>
<p align="center">
<img src="files/dcm.png" height="500" align="center" alt="dicom"></p>
<p>Let’s try a relatively complex example:</p>
<pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># crop parameters</span></span>
<span><span class="va">img</span> <span class="op">=</span> <span class="fu"><a href="reference/dcmread.html">dcmread</a></span><span class="op">(</span><span class="st">'hemorrhage.dcm'</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">=</span> <span class="va">img</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/mask_from_blur.html">mask_from_blur</a></span><span class="op">(</span><span class="fu"><a href="reference/win_brain.html">win_brain</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/mask2bbox.html">mask2bbox</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">types</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'raw'</span>, <span class="st">'normalized'</span>, <span class="st">'brain'</span>, <span class="st">'subdural'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># colors for matrix filling</span></span>
<span><span class="va">colors</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">inferno</a></span><span class="op">(</span><span class="fl">30</span><span class="op">)</span>, <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">magma</a></span><span class="op">(</span><span class="fl">30</span><span class="op">)</span>,</span>
<span>              <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">plasma</a></span><span class="op">(</span><span class="fl">30</span><span class="op">)</span>, <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">cividis</a></span><span class="op">(</span><span class="fl">30</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">scan_</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'uniform_blur2d'</span>, <span class="st">'gauss_blur2d'</span><span class="op">)</span></span>
<span><span class="va">p_</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span> <span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="reference/length.html">length</a></span><span class="op">(</span><span class="va">types</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">scan</span> <span class="op">=</span> <span class="va">scan_</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="fl">4</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">scan</span> <span class="op">=</span> <span class="va">scan_</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">scan</span> <span class="op">=</span> <span class="st">''</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># crop with x/y_lim functions from ggplot</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="fl">2</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">p</span> <span class="op">=</span> <span class="fu">nandb</span><span class="fu">::</span><span class="fu"><a href="https://rorynolan.github.io/nandb/reference/matrix_raster_plot.html" class="external-link">matrix_raster_plot</a></span><span class="op">(</span><span class="va">img</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/get_dcm_matrix.html">get_dcm_matrix</a></span><span class="op">(</span>type <span class="op">=</span> <span class="va">types</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>                                                         scan <span class="op">=</span> <span class="va">scan</span><span class="op">)</span>,</span>
<span>                                                         colours <span class="op">=</span> <span class="va">colors</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">p</span> <span class="op">=</span> <span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">res</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,<span class="va">res</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">res</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,<span class="va">res</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># zoom image (25 %)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="fl">4</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>    <span class="va">img2</span> <span class="op">=</span> <span class="va">img</span></span>
<span>    <span class="va">img2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/zoom.html">zoom</a></span><span class="op">(</span><span class="fl">0.25</span><span class="op">)</span></span>
<span>    <span class="va">p</span> <span class="op">=</span> <span class="fu">nandb</span><span class="fu">::</span><span class="fu"><a href="https://rorynolan.github.io/nandb/reference/matrix_raster_plot.html" class="external-link">matrix_raster_plot</a></span><span class="op">(</span><span class="va">img2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/get_dcm_matrix.html">get_dcm_matrix</a></span><span class="op">(</span>type <span class="op">=</span> <span class="va">types</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>                                                          scan <span class="op">=</span> <span class="va">scan</span><span class="op">)</span>,</span>
<span>                                                          colours <span class="op">=</span> <span class="va">colors</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">p</span> <span class="op">=</span> <span class="fu">nandb</span><span class="fu">::</span><span class="fu"><a href="https://rorynolan.github.io/nandb/reference/matrix_raster_plot.html" class="external-link">matrix_raster_plot</a></span><span class="op">(</span><span class="va">img</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/get_dcm_matrix.html">get_dcm_matrix</a></span><span class="op">(</span>type <span class="op">=</span> <span class="va">types</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>                                                         scan <span class="op">=</span> <span class="va">scan</span><span class="op">)</span>,</span>
<span>                                                         colours <span class="op">=</span> <span class="va">colors</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">p_</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="va">p</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span><span class="va">p_</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                  <span class="va">p_</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                  <span class="va">p_</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                  <span class="va">p_</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">types</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>,</span>
<span>                                 <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">''</span>,<span class="st">''</span>,<span class="va">scan_</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span>                  <span class="op">)</span></span></code></pre>
<p align="center">
<img src="files/dcm2.png" height="500" align="center" alt="dicom2"></p>
</div>
<div class="section level2">
<h2 id="additional-features">Additional features<a class="anchor" aria-label="anchor" href="#additional-features"></a>
</h2>
<div class="section level3">
<h3 id="find-optimal-learning-rate">Find optimal learning rate<a class="anchor" aria-label="anchor" href="#find-optimal-learning-rate"></a>
</h3>
<p>Get optimal learning rate and then fit:</p>
<pre><code><span><span class="va">data</span> <span class="op">=</span> <span class="va">model</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/lr_find.html">lr_find</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">data</span></span>
<span></span>
<span><span class="co"># SuggestedLRs(lr_min=0.017378008365631102, lr_steep=0.0020892962347716093)</span></span></code></pre>
<pre><code>         lr_rates   losses
1 0.0000001000000 5.349157
2 0.0000001202264 5.231493
3 0.0000001445440 5.087494
4 0.0000001737801 5.068282
5 0.0000002089296 5.043181
6 0.0000002511886 5.023340</code></pre>
<p>Visualize:</p>
<pre><code><span><span class="fu">highcharter</span><span class="fu">::</span><span class="fu"><a href="https://jkunst.com/highcharter/reference/hchart.html" class="external-link">hchart</a></span><span class="op">(</span><span class="va">data</span>, <span class="st">"line"</span>, <span class="fu">highcharter</span><span class="fu">::</span><span class="fu"><a href="https://jkunst.com/highcharter/reference/hcaes.html" class="external-link">hcaes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">losses</span>, x <span class="op">=</span> <span class="va">lr_rates</span> <span class="op">)</span><span class="op">)</span></span></code></pre>
<p align="center">
<img src="files/lr.png" height="500" align="center" alt="Learning_rates"></p>
</div>
<div class="section level3">
<h3 id="visualize-batch">Visualize batch<a class="anchor" aria-label="anchor" href="#visualize-batch"></a>
</h3>
<p>Visualize tensor(s):</p>
<pre><code><span><span class="co"># get batch</span></span>
<span><span class="va">batch</span> <span class="op">=</span> <span class="va">dls</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/one_batch.html">one_batch</a></span><span class="op">(</span>convert <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># visualize img 9 with transformations</span></span>
<span><span class="fu">magick</span><span class="fu">::</span><span class="fu">image_read</span><span class="op">(</span><span class="va">batch</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">9</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre>
<p align="center">
<img src="files/cat.png" height="500" align="center" alt="Batch"></p>
</div>
<div class="section level3">
<h3 id="mask">Mask<a class="anchor" aria-label="anchor" href="#mask"></a>
</h3>
<p>Visualize mask:</p>
<pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/EagerAI/fastai" class="external-link">fastai</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># original image</span></span>
<span><span class="va">fns</span> <span class="op">=</span> <span class="fu"><a href="reference/get_image_files.html">get_image_files</a></span><span class="op">(</span><span class="st">'camvid/images'</span><span class="op">)</span></span>
<span><span class="va">cam_fn</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html" class="external-link">capture.output</a></span><span class="op">(</span><span class="va">fns</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># mask</span></span>
<span><span class="va">mask_fn</span> <span class="op">=</span> <span class="st">'camvid/labels/0016E5_01110_P.png'</span></span>
<span><span class="va">cam_img</span> <span class="op">=</span> <span class="fu"><a href="reference/Image_create.html">Image_create</a></span><span class="op">(</span><span class="va">cam_fn</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create mask</span></span>
<span><span class="va">tmask</span> <span class="op">=</span> <span class="fu"><a href="reference/Transform.html">Transform</a></span><span class="op">(</span><span class="fu"><a href="reference/Mask_create.html">Mask_create</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mask</span> <span class="op">=</span> <span class="fu">tmask</span><span class="op">(</span><span class="va">mask_fn</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># visualize</span></span>
<span><span class="va">mask</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/to_matrix.html">to_matrix</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">nandb</span><span class="fu">::</span><span class="fu"><a href="https://rorynolan.github.io/nandb/reference/matrix_raster_plot.html" class="external-link">matrix_raster_plot</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">plasma</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre>
<p align="center">
<img src="files/mask.png" height="500" align="center" alt="Mask"></p>
</div>
<div class="section level3">
<h3 id="tensorpoints">TensorPoints<a class="anchor" aria-label="anchor" href="#tensorpoints"></a>
</h3>
<p>Load Tiny Mnist:</p>
<pre><code><span><span class="co"># download</span></span>
<span><span class="fu"><a href="reference/URLs_MNIST_TINY.html">URLs_MNIST_TINY</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># black and white img</span></span>
<span><span class="va">timg</span> <span class="op">=</span> <span class="fu"><a href="reference/Transform.html">Transform</a></span><span class="op">(</span><span class="va">ImageBW_create</span><span class="op">)</span></span>
<span><span class="va">mnist_fn</span> <span class="op">=</span> <span class="st">"mnist_tiny/valid/3/9007.png"</span></span>
<span><span class="va">mnist_img</span> <span class="op">=</span> <span class="fu">timg</span><span class="op">(</span><span class="va">mnist_fn</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># resize img</span></span>
<span><span class="va">pnt_img</span> <span class="op">=</span> <span class="fu"><a href="reference/TensorImage.html">TensorImage</a></span><span class="op">(</span><span class="va">mnist_img</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/Image_resize.html">Image_resize</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">28</span>,<span class="fl">35</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># visualize</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">pnt_img</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/to_matrix.html">to_matrix</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">nandb</span><span class="fu">::</span><span class="fu"><a href="https://rorynolan.github.io/nandb/reference/matrix_raster_plot.html" class="external-link">matrix_raster_plot</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'white'</span>,<span class="st">'black'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">0</span>, y<span class="op">=</span><span class="fl">0</span><span class="op">)</span>,size<span class="op">=</span><span class="fl">2</span>, colour<span class="op">=</span><span class="st">"red"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">0</span>, y<span class="op">=</span><span class="fl">35</span><span class="op">)</span>,size<span class="op">=</span><span class="fl">2</span>, colour<span class="op">=</span><span class="st">"red"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">28</span>, y<span class="op">=</span><span class="fl">0</span><span class="op">)</span>,size<span class="op">=</span><span class="fl">2</span>, colour<span class="op">=</span><span class="st">"red"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">28</span>, y<span class="op">=</span><span class="fl">35</span><span class="op">)</span>,size<span class="op">=</span><span class="fl">2</span>, colour<span class="op">=</span><span class="st">"red"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">9</span>, y<span class="op">=</span><span class="fl">17</span><span class="op">)</span>,size<span class="op">=</span><span class="fl">2</span>, colour<span class="op">=</span><span class="st">"red"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre>
<p align="center">
<img src="files/ggplot.png" height="500" align="center" alt="Mnist_3"></p>
</div>
<div class="section level3">
<h3 id="annotations-on-tiny-coco">Annotations on Tiny COCO<a class="anchor" aria-label="anchor" href="#annotations-on-tiny-coco"></a>
</h3>
<pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nteetor/zeallot" class="external-link">zeallot</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/EagerAI/fastai" class="external-link">fastai</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/URLs_COCO_TINY.html">URLs_COCO_TINY</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">images</span>, <span class="va">lbl_bbox</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/zeallot/man/operator.html" class="external-link">%&lt;-%</a></span> <span class="fu"><a href="reference/get_annotations.html">get_annotations</a></span><span class="op">(</span><span class="st">'coco_tiny/train.json'</span><span class="op">)</span></span>
<span><span class="va">timg</span> <span class="op">=</span> <span class="fu"><a href="reference/Transform.html">Transform</a></span><span class="op">(</span><span class="va">ImageBW_create</span><span class="op">)</span></span>
<span><span class="va">idx</span> <span class="op">=</span> <span class="fl">49</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">coco_fn</span>,<span class="va">bbox</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/zeallot/man/operator.html" class="external-link">%&lt;-%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'coco_tiny/train'</span>,<span class="va">images</span><span class="op">[[</span><span class="va">idx</span><span class="op">]</span><span class="op">]</span>,sep <span class="op">=</span> <span class="st">'/'</span><span class="op">)</span>,</span>
<span>                       <span class="va">lbl_bbox</span><span class="op">[[</span><span class="va">idx</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">coco_img</span> <span class="op">=</span> <span class="fu">timg</span><span class="op">(</span><span class="va">coco_fn</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tbbox</span> <span class="op">=</span> <span class="fu"><a href="reference/LabeledBBox.html">LabeledBBox</a></span><span class="op">(</span><span class="fu"><a href="reference/TensorBBox.html">TensorBBox</a></span><span class="op">(</span><span class="va">bbox</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="va">bbox</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre>
<pre><code>(#2) [TensorBBox([[ 91.3000,  77.9400, 102.4300,  82.4700],
        [ 27.5800,  77.6500,  40.7600,  82.3400]]),['tv', 'tv']]</code></pre>
<p>Visualize:</p>
<pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://dahtah.github.io/imager/" class="external-link">imager</a></span><span class="op">)</span></span>
<span><span class="va">coco</span> <span class="op">=</span> <span class="fu">imager</span><span class="fu">::</span><span class="fu">load.image</span><span class="op">(</span><span class="va">coco_fn</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/plot.html">plot</a></span><span class="op">(</span><span class="va">coco</span>,axes<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span> <span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="reference/length.html">length</a></span><span class="op">(</span><span class="va">bbox</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/rect.html" class="external-link">rect</a></span><span class="op">(</span><span class="va">bbox</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,<span class="va">bbox</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,</span>
<span>       <span class="va">bbox</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>,<span class="va">bbox</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>,</span>
<span>       border <span class="op">=</span> <span class="st">"white"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="reference/text.html">text</a></span><span class="op">(</span><span class="va">bbox</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">-</span><span class="fl">2.5</span>,<span class="va">bbox</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">+</span><span class="fl">2.5</span>, labels <span class="op">=</span> <span class="va">bbox</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>       offset <span class="op">=</span> <span class="fl">2</span>,</span>
<span>       pos <span class="op">=</span> <span class="fl">2</span>,</span>
<span>       cex <span class="op">=</span> <span class="fl">1</span>,</span>
<span>       col <span class="op">=</span> <span class="st">"white"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
<p align="center">
<img src="files/annotate.png" height="500" align="center" alt="Annotation"></p>
<p>Alternatively, we could see batch via dataloader:</p>
<pre><code><span><span class="va">idx</span> <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">coco_fn</span>,<span class="va">bbox</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/zeallot/man/operator.html" class="external-link">%&lt;-%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'coco_tiny/train'</span>,<span class="va">images</span><span class="op">[[</span><span class="va">idx</span><span class="op">]</span><span class="op">]</span>,sep <span class="op">=</span> <span class="st">'/'</span><span class="op">)</span>,</span>
<span>                          <span class="va">lbl_bbox</span><span class="op">[[</span><span class="va">idx</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">coco_bb</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span> <span class="fu"><a href="reference/TensorBBox_create.html">TensorBBox_create</a></span><span class="op">(</span><span class="va">bbox</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">coco_lbl</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">bbox</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">coco_dsrc</span> <span class="op">=</span> <span class="fu"><a href="reference/Datasets.html">Datasets</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">coco_fn</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="reference/Image_create.html">Image_create</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">coco_bb</span><span class="op">)</span>,</span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="va">coco_lbl</span>, <span class="fu"><a href="reference/MultiCategorize.html">MultiCategorize</a></span><span class="op">(</span>add_na <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">)</span></span>
<span>                          <span class="op">)</span>, n_inp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">coco_tdl</span> <span class="op">=</span> <span class="fu"><a href="reference/TfmdDL.html">TfmdDL</a></span><span class="op">(</span><span class="va">coco_dsrc</span>, bs <span class="op">=</span> <span class="fl">9</span>,</span>
<span>                  after_item <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="reference/BBoxLabeler.html">BBoxLabeler</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="reference/PointScaler.html">PointScaler</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                                 <span class="fu"><a href="reference/ToTensor.html">ToTensor</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  after_batch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="reference/IntToFloatTensor.html">IntToFloatTensor</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>                  <span class="op">)</span></span>
<span></span>
<span><span class="va">coco_tdl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/show_batch.html">show_batch</a></span><span class="op">(</span>dpi <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span></code></pre>
<p align="center">
<img src="files/annotate_.png" height="500" align="center" alt="Annotation_"></p>
</div>
<div class="section level3">
<h3 id="nn-module">NN module<a class="anchor" aria-label="anchor" href="#nn-module"></a>
</h3>
<p>To build a custom sequential model and pass it to learner:</p>
<pre><code><span><span class="va">nn</span><span class="op">$</span><span class="fu">Sequential</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">nn</span><span class="op">$</span><span class="fu">Conv2d</span><span class="op">(</span><span class="fl">1L</span>,<span class="fl">20L</span>,<span class="fl">5L</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">nn</span><span class="op">$</span><span class="fu">Conv2d</span><span class="op">(</span><span class="fl">1L</span>,<span class="fl">20L</span>,<span class="fl">5L</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">nn</span><span class="op">$</span><span class="fu">Conv2d</span><span class="op">(</span><span class="fl">1L</span>,<span class="fl">20L</span>,<span class="fl">5L</span><span class="op">)</span></span></code></pre>
<pre><code>Sequential(
  (0): Conv2d(1, 20, kernel_size=(5, 5), stride=(1, 1))
  (1): Conv2d(1, 20, kernel_size=(5, 5), stride=(1, 1))
  (2): Conv2d(1, 20, kernel_size=(5, 5), stride=(1, 1))
)</code></pre>
<p>To specify the name of the layers, one has to pass layer within lists, because torch layers have no <code>name</code> argument:</p>
<pre><code><span><span class="va">nn</span><span class="op">$</span><span class="fu">Sequential</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">nn</span><span class="op">$</span><span class="fu">Conv2d</span><span class="op">(</span><span class="fl">1L</span>,<span class="fl">20L</span>,<span class="fl">5L</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">'my_conv2'</span>,<span class="va">nn</span><span class="op">$</span><span class="fu">Conv2d</span><span class="op">(</span><span class="fl">1L</span>,<span class="fl">20L</span>,<span class="fl">5L</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">nn</span><span class="op">$</span><span class="fu">Conv2d</span><span class="op">(</span><span class="fl">1L</span>,<span class="fl">20L</span>,<span class="fl">5L</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">'my_conv4'</span>,<span class="va">nn</span><span class="op">$</span><span class="fu">Conv2d</span><span class="op">(</span><span class="fl">1L</span>,<span class="fl">20L</span>,<span class="fl">5L</span><span class="op">)</span><span class="op">)</span></span></code></pre>
<pre><code>Sequential(
  (0): Conv2d(1, 20, kernel_size=(5, 5), stride=(1, 1))
  (my_conv2): Conv2d(1, 20, kernel_size=(5, 5), stride=(1, 1))
  (1): Conv2d(1, 20, kernel_size=(5, 5), stride=(1, 1))
  (my_conv4): Conv2d(1, 20, kernel_size=(5, 5), stride=(1, 1))
)</code></pre>
</div>
</div>
<div class="section level2">
<h2 id="code-of-conduct">Code of Conduct<a class="anchor" aria-label="anchor" href="#code-of-conduct"></a>
</h2>
<p>Please note that the fastai project is released with a <a href="https://contributor-covenant.org/version/2/0/CODE_OF_CONDUCT.html" class="external-link">Contributor Code of Conduct</a>. By contributing to this project, you agree to abide by its terms.</p>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=fastai" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/EagerAI/fastai/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/EagerAI/fastai/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>Apache License 2.0</li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing fastai</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://github.com/henry090" class="external-link">Turgut Abdullayev</a> <br><small class="roles"> Contributor, maintainer, copyright holder, author </small>  </li>
</ul>
</div>



  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://github.com/henry090" class="external-link">Turgut Abdullayev</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '6a624258596123d42fd1f24a82ab617a',
    indexName: 'henry090',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
