<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Speech Recognition ‚Ä¢ fastai</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/readable/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Speech Recognition">
<meta property="og:description" content="fastai">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fastai</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Basic_Tabular.html">Basic Tabular</a>
    </li>
    <li>
      <a href="../articles/basic_img_class.html">Basic Image classification</a>
    </li>
    <li>
      <a href="../articles/head_pose.html">Head pose</a>
    </li>
    <li>
      <a href="../articles/super_res_gan.html">Super-Resolution GAN</a>
    </li>
    <li>
      <a href="../articles/medical_dcm.html">Medical image classification</a>
    </li>
    <li>
      <a href="../articles/data_aug.html">Data augmentation</a>
    </li>
    <li>
      <a href="../articles/obj_detect.html">Object detection</a>
    </li>
    <li>
      <a href="../articles/audio.html">Audio classification</a>
    </li>
    <li>
      <a href="../articles/time_series.html">Time series</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Migrate
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/migrating_pytorch.html">Plain Pytorch</a>
    </li>
    <li>
      <a href="../articles/migrating_ignite.html">Ignite</a>
    </li>
    <li>
      <a href="../articles/lightning.html">Lightning</a>
    </li>
    <li>
      <a href="../articles/catalyst.html">Catalyst</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Learn
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/custom_img.html">Image Classification</a>
    </li>
    <li>
      <a href="../articles/audio2tf.html">Speech Recognition</a>
    </li>
    <li>
      <a href="../articles/gpt.html">GPT2</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Training
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/optimizer.html">Optimizers</a>
    </li>
    <li>
      <a href="../articles/callbacks.html">Callbacks</a>
    </li>
    <li>
      <a href="../articles/low.html">Low-level API</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    NLP
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/textclassification.html">RoBERTa binary classification</a>
    </li>
    <li>
      <a href="../articles/multilabel.html">Multilabel classification</a>
    </li>
    <li>
      <a href="../articles/question_answering.html">Question-answering</a>
    </li>
    <li>
      <a href="../articles/textsummarize.html">Text-summarization</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Refer</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/henry090/fastai/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="audio2tf_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="audio2tf_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="audio2tf_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Speech Recognition</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/henry090/fastai/blob/master/vignettes/audio2tf.Rmd"><code>vignettes/audio2tf.Rmd</code></a></small>
      <div class="hidden name"><code>audio2tf.Rmd</code></div>

    </div>

    
    
<div id="intro" class="section level2">
<h2 class="hasAnchor">
<a href="#intro" class="anchor"></a>Intro</h2>
<p>The <a href="https://github.com/fastai/fastai">fastai</a> library simplifies training fast and accurate neural nets using modern best practices. See the fastai website to get started. The library is based on research into deep learning best practices undertaken at <code>fast.ai</code>, and includes ‚Äúout of the box‚Äù support for <code>vision</code>, <code>text</code>, <code>tabular</code>, and <code>collab</code> (collaborative filtering) models.</p>
</div>
<div id="dataset" class="section level2">
<h2 class="hasAnchor">
<a href="#dataset" class="anchor"></a>Dataset</h2>
<p>Grab data from TensorFlow Speech Commands (2.3 GB):</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">commands_path</span> <span class="op">=</span> <span class="st">"SPEECHCOMMANDS"</span>
<span class="va">audio_files</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_audio_files.html">get_audio_files</a></span><span class="op">(</span><span class="va">commands_path</span><span class="op">)</span>
<span class="fu"><a href="../reference/length.html">length</a></span><span class="op">(</span><span class="va">audio_files</span><span class="op">$</span><span class="va">items</span><span class="op">)</span>
<span class="co"># [1] 105835</span></code></pre></div>
</div>
<div id="preprocess" class="section level2">
<h2 class="hasAnchor">
<a href="#preprocess" class="anchor"></a>Preprocess</h2>
<p>Prepare dataset and put into data loader:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">DBMelSpec</span> <span class="op">=</span> <span class="fu"><a href="../reference/SpectrogramTransformer.html">SpectrogramTransformer</a></span><span class="op">(</span>mel<span class="op">=</span><span class="cn">TRUE</span>, to_db<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">a2s</span> <span class="op">=</span> <span class="fu">DBMelSpec</span><span class="op">(</span><span class="op">)</span>
<span class="va">crop_4000ms</span> <span class="op">=</span> <span class="fu"><a href="../reference/ResizeSignal.html">ResizeSignal</a></span><span class="op">(</span><span class="fl">4000</span><span class="op">)</span>
<span class="va">tfms</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">crop_4000ms</span>, <span class="va">a2s</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">auds</span> <span class="op">=</span> <span class="fu"><a href="../reference/DataBlock.html">DataBlock</a></span><span class="op">(</span>blocks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/AudioBlock.html">AudioBlock</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="../reference/CategoryBlock.html">CategoryBlock</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,  
                 get_items <span class="op">=</span> <span class="va">get_audio_files</span>, 
                 splitter <span class="op">=</span> <span class="fu"><a href="../reference/RandomSplitter.html">RandomSplitter</a></span><span class="op">(</span><span class="op">)</span>,
                 item_tfms <span class="op">=</span> <span class="va">tfms</span>,
                 get_y <span class="op">=</span> <span class="va">parent_label</span><span class="op">)</span>

<span class="va">audio_dbunch</span> <span class="op">=</span> <span class="va">auds</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/dataloaders.html">dataloaders</a></span><span class="op">(</span><span class="va">commands_path</span>, item_tfms <span class="op">=</span> <span class="va">tfms</span>, bs <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></code></pre></div>
<p>See batch:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">audio_dbunch</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/show_batch.html">show_batch</a></span><span class="op">(</span>figsize <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">8.5</span><span class="op">)</span>, nrows <span class="op">=</span> <span class="fl">3</span>, ncols <span class="op">=</span> <span class="fl">3</span>, max_n <span class="op">=</span> <span class="fl">9</span>, dpi <span class="op">=</span> <span class="fl">180</span><span class="op">)</span></code></pre></div>
</div>
<div id="model" class="section level2">
<h2 class="hasAnchor">
<a href="#model" class="anchor"></a>Model</h2>
<p>Before fitting, 3 channels to 1 channel:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">torch</span> <span class="op">=</span> <span class="fu"><a href="../reference/torch.html">torch</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">nn</span> <span class="op">=</span> <span class="fu"><a href="../reference/nn.html">nn</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">learn</span> <span class="op">=</span> <span class="fu"><a href="../reference/Learner.html">Learner</a></span><span class="op">(</span><span class="va">dls</span>, <span class="fu"><a href="../reference/xresnet18.html">xresnet18</a></span><span class="op">(</span>pretrained <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, <span class="va">nn</span><span class="op">$</span><span class="fu">CrossEntropyLoss</span><span class="op">(</span><span class="op">)</span>, metrics<span class="op">=</span><span class="va">accuracy</span><span class="op">)</span>

<span class="co"># channel from 3 to 1</span>
<span class="va">learn</span><span class="op">$</span><span class="va">model</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span><span class="op">[[</span><span class="st">'in_channels'</span><span class="op">]</span><span class="op">]</span> <span class="op">%f%</span> <span class="fl">1L</span>
<span class="co"># reshape</span>
<span class="va">new_weight_shape</span> <span class="op">&lt;-</span> <span class="va">torch</span><span class="op">$</span><span class="va">nn</span><span class="op">$</span><span class="va">parameter</span><span class="op">$</span><span class="fu">Parameter</span><span class="op">(</span>
  <span class="op">(</span><span class="va">learn</span><span class="op">$</span><span class="va">model</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span><span class="op">$</span><span class="va">weight</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/narrow.html">narrow</a></span><span class="op">(</span><span class="st">'[:,1,:,:]'</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="fu">unsqueeze</span><span class="op">(</span><span class="fl">1L</span><span class="op">)</span><span class="op">)</span>

<span class="co"># assign with %f%</span>
<span class="va">learn</span><span class="op">$</span><span class="va">model</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span><span class="op">[[</span><span class="st">'weight'</span><span class="op">]</span><span class="op">]</span> <span class="op">%f%</span> <span class="va">new_weight_shape</span></code></pre></div>
</div>
<div id="add-callbacks" class="section level2">
<h2 class="hasAnchor">
<a href="#add-callbacks" class="anchor"></a>Add callbacks</h2>
<p>Weights and biases could be save and visualized on <a href="https://wandb.ai/">wandb.ai</a>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># login for the 1st time then remove it</span>
<span class="fu"><a href="../reference/login.html">login</a></span><span class="op">(</span><span class="st">"API_key_from_wandb_dot_ai"</span><span class="op">)</span>
<span class="fu"><a href="../reference/init.html">init</a></span><span class="op">(</span>project<span class="op">=</span><span class="st">'R'</span><span class="op">)</span></code></pre></div>
<pre><code>wandb: Currently logged in as: henry090 (use `wandb login --relogin` to force relogin)
wandb: Tracking run with wandb version 0.10.8
wandb: Syncing run macabre-zombie-2
wandb: ‚≠êÔ∏è View project at https://wandb.ai/henry090/speech_recognition_from_R
wandb: üöÄ View run at https://wandb.ai/henry090/speech_recognition_from_R/runs/2sjw3juv
wandb: Run data is saved locally in wandb/run-20201030_224503-2sjw3juv
wandb: Run `wandb off` to turn off syncing.</code></pre>
</div>
<div id="conclusion" class="section level2">
<h2 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h2>
<p>Now we can train our model:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">learn</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/fit_one_cycle.html">fit_one_cycle</a></span><span class="op">(</span><span class="fl">3</span>, lr_max<span class="op">=</span><span class="fu"><a href="../reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1e-2</span><span class="op">)</span>, cbs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/WandbCallback.html">WandbCallback</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>epoch   train_loss   valid_loss   accuracy   time 
------  -----------  -----------  ---------  -----
epoch   train_loss   valid_loss   accuracy   time 
------  -----------  -----------  ---------  -----
WandbCallback requires use of "SaveModelCallback" to log best model
0       0.590236     0.728817     0.787121   04:18 
WandbCallback was not able to get prediction samples -&gt; wandb.log must be passed a dictionary
1       0.288492     0.310335     0.908490   04:19 
2       0.182899     0.196792     0.941088   04:10 </code></pre>
<p>See beautiful dashboard here:</p>
<pre><code>https://wandb.ai/henry090/speech_recognition_from_R/runs/2sjw3juv?workspace=user-henry090</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://github.com/henry090">Turgut Abdullayev</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '6a624258596123d42fd1f24a82ab617a',
    indexName: 'henry090',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
